/*! LineUpJS - v0.2.0 - 2016-01-15
* https://github.com/sgratzl/lineup.js
* Copyright (c) 2016 ; Licensed BSD */

//based on https://github.com/ForbesLindesay/umd but with a custom list of external dependencies
;(function (f) {
  // CommonJS
  if (typeof exports === "object" && typeof module !== "undefined") {
    module.exports = f(require)(1);

    // RequireJS
  } else if (typeof define === "function" && define.amd) {
    var deps = ['d3'];
    define(deps, function () {
      var resolved_deps = arguments;
      return f(function(name) { return resolved_deps[deps.indexOf(name)]; })(1);
    });
    // <script>
  } else {
    var g;
    if (typeof window !== "undefined") {
      g = window;
    } else if (typeof global !== "undefined") {
      g = global;
    } else if (typeof self !== "undefined") {
      g = self;
    } else {
      // works providing we're not in "use strict";
      // needed for Java 8 Nashorn
      // seee https://github.com/facebook/react/issues/3037
      g = this;
    }
    g.LineUpJS = f(function(name) { return g[name]; })(1);
  }

})(function (require) {
  return !function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){function d(a){var b=n.scale.category10().range().slice();return a.forEach(function(a){switch(a.type){case"number":a.color=b.shift()}}),a}function e(a,b,c){return void 0===c&&(c={}),new i.LocalDataProvider(a,b,c)}function f(a,b,c){return void 0===c&&(c={}),new o(b,a,c)}var g=this&&this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);a.prototype=null===b?Object.create(b):(c.prototype=b.prototype,new c)},h=a("./model"),i=a("./provider"),j=a("./renderer"),k=a("./ui"),l=a("./utils"),m=a("./ui_dialogs"),n=a("d3");c.model=h,c.provider=i,c.renderer=j,c.ui=k,c.utils=l,c.ui_dialogs=m;var o=function(a){function b(b,d,e){var f=this;void 0===e&&(e={}),a.call(this),this.data=d,this.config={idPrefix:Math.random().toString(36).slice(-8).substr(0,3),numberformat:n.format(".3n"),htmlLayout:{headerHeight:20,headerHistogramHeight:40,autoRotateLabels:!1,rotationHeight:50,rotationDegree:-20,headerOffset:1,buttonTopPadding:10,labelLeftPadding:5},renderingOptions:{stacked:!1,animation:!0,visibleRowsOnly:!0,histograms:!1,meanLine:!1},svgLayout:{rowHeight:17,rowPadding:.2,rowBarPadding:1,visibleRowsOnly:!0,backupScrollRows:4,animationDuration:1e3,freezeCols:0,rowActions:[]},manipulative:!0,interaction:{tooltips:!0,multiselect:function(){return!1},rangeselect:function(){return!1}},pool:!1},this.body=null,this.header=null,this.pools=[],this.contentScroller=null,this.$container=b instanceof n.selection?b:n.select(b),this.$container=this.$container.append("div").classed("lu",!0),c.utils.merge(this.config,e),this.data.on("selectionChanged.main",this.triggerSelection.bind(this)),this.header=new k.HeaderRenderer(d,this.node,{manipulative:this.config.manipulative,headerHeight:this.config.htmlLayout.headerHeight,headerHistogramHeight:this.config.htmlLayout.headerHistogramHeight,histograms:this.config.renderingOptions.histograms,autoRotateLabels:this.config.htmlLayout.autoRotateLabels,rotationHeight:this.config.htmlLayout.rotationHeight,rotationDegree:this.config.htmlLayout.rotationDegree,freezeCols:this.config.svgLayout.freezeCols}),this.body=new k.BodyRenderer(d,this.node,this.slice.bind(this),{rowHeight:this.config.svgLayout.rowHeight,rowPadding:this.config.svgLayout.rowPadding,rowBarPadding:this.config.svgLayout.rowBarPadding,animationDuration:this.config.svgLayout.animationDuration,meanLine:this.config.renderingOptions.meanLine,animation:this.config.renderingOptions.animation,stacked:this.config.renderingOptions.stacked,actions:this.config.svgLayout.rowActions,idPrefix:this.config.idPrefix,freezeCols:this.config.svgLayout.freezeCols}),this.body.histCache=this.header.sharedHistCache,this.forward(this.body,"hoverChanged"),this.config.pool&&this.config.manipulative&&this.addPool(new k.PoolRenderer(d,this.node,this.config)),this.config.svgLayout.visibleRowsOnly&&(this.contentScroller=new l.ContentScroller(this.$container.node(),this.body.node,{backupRows:this.config.svgLayout.backupScrollRows,rowHeight:this.config.svgLayout.rowHeight,topShift:function(){return f.header.currentHeight()}}),this.contentScroller.on("scroll",function(a,b){f.header.$node.style("transform","translate(0px,"+a+"px)"),f.config.svgLayout.freezeCols>0&&(f.header.updateFreeze(b),f.body.updateFreeze(b))}),this.contentScroller.on("redraw",this.body.update.bind(this.body)))}return g(b,a),b.prototype.createEventList=function(){return a.prototype.createEventList.call(this).concat(["hoverChanged","selectionChanged","multiSelectionChanged"])},b.prototype.addPool=function(a,b){return void 0===b&&(b=this.config),a instanceof k.PoolRenderer?this.pools.push(a):this.pools.push(new k.PoolRenderer(this.data,a,b)),this.pools[this.pools.length-1]},Object.defineProperty(b.prototype,"node",{get:function(){return this.$container.node()},enumerable:!0,configurable:!0}),b.prototype.slice=function(a,b,c){return this.contentScroller?this.contentScroller.select(a,b,c):{from:a,to:b}},b.prototype.destroy=function(){this.pools.forEach(function(a){return a.remove()}),this.$container.remove(),this.contentScroller&&this.contentScroller.destroy()},b.prototype.sortBy=function(a,b){void 0===b&&(b=!1);var c=this.data.find(a);return c&&c.sortByMe(b),null!==c},b.prototype.dump=function(){var a=this.data.dump();return a},b.prototype.changeDataStorage=function(a,b){this.data&&this.data.on("selectionChanged.main",null),this.data=a,b&&this.data.restore(b),this.data.on("selectionChanged.main",this.triggerSelection.bind(this)),this.header.changeDataStorage(a),this.body.changeDataStorage(a),this.pools.forEach(function(b){return b.changeDataStorage(a)}),this.update()},b.prototype.triggerSelection=function(a){this.fire("selectionChanged",a.length>0?a[0]:-1),this.fire("multiSelectionChanged",a)},b.prototype.restore=function(a){this.changeDataStorage(this.data,a)},b.prototype.update=function(){this.header.update(),this.body.update(),this.pools.forEach(function(a){return a.update()})},b.prototype.changeRenderingOption=function(a,b){this.config.renderingOptions[a]=b,("animation"===a||"stacked"===a)&&(this.body.setOption(a,b),this.body.update())},b}(l.AEventDispatcher);c.LineUp=o,c.deriveColors=d,c.createLocalStorage=e,c.create=f},{"./model":3,"./provider":4,"./renderer":5,"./ui":6,"./ui_dialogs":7,"./utils":8,d3:void 0}],2:[function(a,b,c){function d(a,b,c){return Math.max(Math.min(a,c),b)}function e(a,b,c,d,e){return void 0===e&&(e={}),new i(a,b,c,d,e)}var f=a("d3"),g=a("./utils"),h=a("./model"),i=function(){function a(a,b,c,d,e){void 0===e&&(e={}),this.parent=a,this.scale_=b,this.original=c,this.dataPromise=d,this.options={width:320,height:200,padding_hor:5,padding_ver:5,radius:5,callback:function(a){return a},callbackThisArg:null,triggerCallback:"change"},g.merge(this.options,e),this.scale_=b.clone(),this.build(f.select(a))}return Object.defineProperty(a.prototype,"scale",{get:function(){return this.scale_},enumerable:!0,configurable:!0}),a.prototype.build=function(a){function b(){q.attr({x1:function(a){return p(l.scale.apply(a))},x2:o}).style("visibility",function(a){var b=l.scale.domain;return a<b[0]||a>b[b.length-1]?"hidden":null})}function c(a){return f.behavior.drag().on("dragstart",function(){f.select(this).classed("dragging",!0).attr("r",1.1*k.radius)}).on("drag",a).on("dragend",function(){f.select(this).classed("dragging",!1).attr("r",k.radius),i(!0)})}function e(){function g(){r.sort(function(a,b){return a.r-b.r}),q.domain=r.map(function(a){return a.r}),q.range=r.map(function(a){return a.n}),b()}function i(a){r.length<=2||(r.splice(a,1),g(),e())}function j(a){a=d(a,0,m),r.push({n:p.invert(a),r:o.invert(a)}),g(),e()}if(l.scale instanceof h.ScaleMappingFunction){var q=l.scale,s=q.domain,t=q.range;r=s.map(function(a,b){return{r:a,n:t[b]}}),a.selectAll("rect").on("click",function(){j(f.mouse(a.select("svg > g").node())[0])});var u=a.select("g.mappings").selectAll("g.mapping").data(r),v=u.enter().append("g").classed("mapping",!0).on("contextmenu",function(a,b){f.event.preventDefault(),f.event.stopPropagation(),i(b)});v.append("line").attr({y1:0,y2:n}).call(c(function(a){var b=f.event.dx,c=d(p(a.n)+b,0,m),e=d(o(a.r)+b,0,m);a.n=p.invert(c),a.r=o.invert(e),f.select(this).attr("x1",c).attr("x2",e),f.select(this.parentElement).select("circle.normalized").attr("cx",c),f.select(this.parentElement).select("circle.raw").attr("cx",e),g()})),v.append("circle").classed("normalized",!0).attr("r",k.radius).call(c(function(a){var b=d(f.event.x,0,m);a.n=p.invert(b),f.select(this).attr("cx",b),f.select(this.parentElement).select("line").attr("x1",b),g()})),v.append("circle").classed("raw",!0).attr("r",k.radius).attr("cy",n).call(c(function(a){var b=d(f.event.x,0,m);a.r=o.invert(b),f.select(this).attr("cx",b),f.select(this.parentElement).select("line").attr("x2",b),g()})),u.select("line").attr({x1:function(a){return p(a.n)},x2:function(a){return o(a.r)}}),u.select("circle.normalized").attr("cx",function(a){return p(a.n)}),u.select("circle.raw").attr("cx",function(a){return o(a.r)}),u.exit().remove()}}function g(){if(!(l.scale instanceof h.ScriptMappingFunction))return void a.select("div.script").style("display","none");a.select("div.script").style("display",null);var c=l.scale,d=a.select("textarea").text(c.code);a.select("div.script").select("button").on("click",function(){var a=d.property("value");c.code=a,b(),i()})}function i(a){void 0===a&&(a=!1),a&&"dragend"!==k.triggerCallback||k.callback.call(k.callbackThisArg,l.scale.clone())}function j(){var c=o.domain();a.select("input.raw_min").property("value",c[0]),a.select("input.raw_max").property("value",c[1]),b(),e()}var k=this.options,l=this;a=a.append("div").classed("lugui-me",!0),a.node().innerHTML='<div>\n    <span class="raw_min">0</span>\n    <span class="center"><label><select>\n        <option value="linear">Linear</option>\n        <option value="linear_invert">Invert</option>\n        <option value="linear_abs">Absolute</option>\n        <option value="log">Log</option>\n        <option value="pow1.1">Pow 1.1</option>\n        <option value="pow2">Pow 2</option>\n        <option value="pow3">Pow 3</option>\n        <option value="sqrt">Sqrt</option>\n        <option value="script">Custom Script</option>\n      </select></label>\n      </span>\n    <span class="raw_max">1</span>\n  </div>\n  <svg width="'+k.width+'" height="'+k.height+'">\n    <rect width="100%" height="10"></rect>\n    <rect width="100%" height="10" y="'+(k.height-10)+'"></rect>\n    <g transform="translate('+k.padding_hor+","+k.padding_ver+')">\n      <g class="samples">\n\n      </g>\n      <g class="mappings">\n\n      </g>\n    </g>\n  </svg>\n  <div>\n    <input type="text" class="raw_min" value="0">\n    <span class="center">Raw</span>\n    <input type="text" class="raw_max" value="1">\n  </div>\n  <div class="script">\n    <textarea>\n\n    </textarea>\n    <button>Apply</button>\n  </div>';var m=k.width-2*k.padding_hor,n=k.height-2*k.padding_ver,o=f.scale.linear().domain([Math.min(this.scale.domain[0],this.original.domain[0]),Math.min(this.scale.domain[1],this.original.domain[1])]).range([0,m]),p=f.scale.linear().domain([0,1]).range([0,m]);a.select("input.raw_min").property("value",o.domain()[0]).on("blur",function(){var a=o.domain();a[0]=parseFloat(this.value),o.domain(a),j()}),a.select("input.raw_max").property("value",o.domain()[1]).on("blur",function(){var a=o.domain();a[1]=parseFloat(this.value),o.domain(a),j()});var q=a.select("g.samples").selectAll("line").data([]);this.dataPromise.then(function(a){a=f.set(a.map(String)).values().map(parseFloat),q=q.data(a),q.enter().append("line").attr({x1:function(a){return p(l.scale.apply(a))},y1:0,x2:o,y2:n}).style("visibility",function(a){var b=l.scale.domain;return a<b[0]||a>b[b.length-1]?"hidden":null})});var r=[];e(),g(),j(),a.select("select").on("change",function(){var a=this.value;if("linear_invert"===a)l.scale_=new h.ScaleMappingFunction(o.domain(),"linear",[1,0]);else if("linear_abs"===a){var c=o.domain();l.scale_=new h.ScaleMappingFunction([c[0],(c[1]-c[0])/2,c[1]],"linear",[1,0,1])}else"script"===a?l.scale_=new h.ScriptMappingFunction(o.domain()):l.scale_=new h.ScaleMappingFunction(o.domain(),a);b(),e(),g(),i()}).property("selectedIndex",function(){var a="script";l.scale_ instanceof h.ScaleMappingFunction&&(a=l.scale.scaleType);var b=["linear","linear_invert","linear_abs","log","pow1.1","pow2","pow3","sqrt","script"];return b.indexOf(a)})},a}();c.create=e},{"./model":3,"./utils":8,d3:void 0}],3:[function(a,b,c){function d(a){return a.replace(/[\s!#$%&'\(\)\*\+,\.\/:;<=>\?@\[\\\]\^`\{\|}~]/g,"_")}function e(a,b){return a===b||isNaN(a)&&isNaN(b)?0:a-b}function f(a){return a instanceof q&&"function"==typeof a.getNumber||!(a instanceof q)&&null!=a.type.match(/(number|stack|ordinal)/)}function g(a){return a instanceof q&&"function"==typeof a.getCategories||!(a instanceof q)&&null!=a.type.match(/(categorical|ordinal)/)}function h(a){switch(void 0===a&&(a="linear"),a){case"log":return o.scale.log().clamp(!0);case"sqrt":return o.scale.sqrt().clamp(!0);case"pow1.1":return o.scale.pow().exponent(1.1).clamp(!0);case"pow2":return o.scale.pow().exponent(2).clamp(!0);case"pow3":return o.scale.pow().exponent(3).clamp(!0);default:return o.scale.linear().clamp(!0)}}function i(a,b){return a.length!==b.length?!1:a.every(function(a,c){return a===b[c]})}function j(a,b){return"log"===b&&0===a[0]&&(a[0]=1e-7),a}function k(a){if("script"===a.type){var b=new u;return b.restore(a),b}var c=new t;return c.restore(a),c}function l(a){return void 0===a&&(a="actions"),{type:"actions",label:a}}function m(){return{number:v,string:w,link:x,stack:B,rank:C,categorical:z,ordinal:A,actions:s,annotate:y}}var n=this&&this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);a.prototype=null===b?Object.create(b):(c.prototype=b.prototype,new c)},o=a("d3"),p=a("./utils"),q=function(a){function b(c,e){a.call(this),this.desc=e,this.width_=100,this.parent=null,this._compressed=!1,this.id=d(c),this.label=this.desc.label||this.id,this.cssClass=this.desc.cssClass||"",this.color=this.desc.color||(""!==this.cssClass?null:b.DEFAULT_COLOR)}return n(b,a),Object.defineProperty(b.prototype,"headerCssClass",{get:function(){return this.desc.type},enumerable:!0,configurable:!0}),b.prototype.assignNewId=function(a){this.id=d(a())},b.prototype.init=function(a){return Promise.resolve(!0)},Object.defineProperty(b.prototype,"fqid",{get:function(){return this.parent?this.parent.fqid+"_"+this.id:this.id},enumerable:!0,configurable:!0}),b.prototype.createEventList=function(){return a.prototype.createEventList.call(this).concat(["widthChanged","filterChanged","labelChanged","compressChanged","addColumn","removeColumn","dirty","dirtyHeader","dirtyValues"])},b.prototype.getWidth=function(){return this.width_},Object.defineProperty(b.prototype,"compressed",{get:function(){return this._compressed},set:function(a){this._compressed!==a&&this.fire(["compressChanged","dirtyHeader","dirtyValues","dirty"],this._compressed,this._compressed=a)},enumerable:!0,configurable:!0}),b.prototype.flatten=function(a,c,d,e){void 0===d&&(d=0),void 0===e&&(e=0);var f=this.compressed?b.COMPRESSED_WIDTH:this.getWidth();return a.push({col:this,offset:c,width:f}),f},b.prototype.setWidth=function(a){this.width_!==a&&this.fire(["widthChanged","dirtyHeader","dirtyValues","dirty"],this.width_,this.width_=a)},b.prototype.setWidthImpl=function(a){this.width_=a},b.prototype.setMetaData=function(a,b){if(void 0===b&&(b=this.color),a!==this.label||this.color!==b){var c=this.color===b?["labelChanged","dirtyHeader","dirty"]:["labelChanged","dirtyHeader","dirtyValues","dirty"];this.fire(c,{label:this.label,color:this.color},{label:this.label=a,color:this.color=b})}},b.prototype.sortByMe=function(a){void 0===a&&(a=!1);var b=this.findMyRanker();return b?b.sortBy(this,a):!1},b.prototype.toggleMySorting=function(){var a=this.findMyRanker();return a?a.toggleSorting(this):!1},b.prototype.removeMe=function(){return this.parent?this.parent.remove(this):!1},b.prototype.insertAfterMe=function(a){return this.parent?this.parent.insertAfter(a,this):!1},b.prototype.findMyRanker=function(){return this.parent?this.parent.findMyRanker():null},b.prototype.dump=function(a){var c={id:this.id,desc:a(this.desc),width:this.width_,compressed:this.compressed};return this.label!==(this.desc.label||this.id)&&(c.label=this.label),this.color!==(this.desc.color||b.DEFAULT_COLOR)&&this.color&&(c.color=this.color),c},b.prototype.restore=function(a,b){this.width_=a.width||this.width_,this.label=a.label||this.label,this.color=a.color||this.color,this.compressed=a.compressed===!0},b.prototype.getLabel=function(a){return""+this.getValue(a)},b.prototype.getValue=function(a){return""},b.prototype.compare=function(a,b){return 0},b.prototype.isFiltered=function(){return!1},b.prototype.filter=function(a){return null!==a},b.DEFAULT_COLOR="#C1C1C1",b.FLAT_ALL_COLUMNS=-1,b.COMPRESSED_WIDTH=16,b}(p.AEventDispatcher);c.Column=q;var r=function(a){function b(b,c){a.call(this,b,c),this.accessor=c.accessor||function(a,b,c){return null}}return n(b,a),b.prototype.getLabel=function(a){return""+this.getValue(a)},b.prototype.getValue=function(a){return this.accessor(a,this.id,this.desc)},b.prototype.compare=function(a,b){return 0},b}(q);c.ValueColumn=r;var s=function(a){function b(b,c){a.call(this,b,c)}return n(b,a),b.prototype.getLabel=function(a){return""},b.prototype.getValue=function(a){return""},b.prototype.compare=function(a,b){return 0},b}(q);c.DummyColumn=s,c.isNumberColumn=f,c.isCategoricalColumn=g;var t=function(){function a(a,b,c){void 0===a&&(a=[0,1]),void 0===b&&(b="linear"),void 0===c&&(c=[0,1]),this.type=b,this.s=h(b).domain(j(a,this.type)).range(c)}return Object.defineProperty(a.prototype,"domain",{get:function(){return this.s.domain()},set:function(a){this.s.domain(j(a,this.type))},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"range",{get:function(){return this.s.range()},set:function(a){this.s.range(a)},enumerable:!0,configurable:!0}),a.prototype.apply=function(a){return this.s(a)},Object.defineProperty(a.prototype,"scaleType",{get:function(){return this.type},enumerable:!0,configurable:!0}),a.prototype.dump=function(){return{type:this.type,domain:this.domain,range:this.range}},a.prototype.eq=function(b){if(!(b instanceof a))return!1;var c=b;return c.type===this.type&&i(this.domain,c.domain)&&i(this.range,c.range)},a.prototype.restore=function(a){this.type=a.type,this.s=h(a.type).domain(a.domain).range(a.range)},a.prototype.clone=function(){return new a(this.domain,this.type,this.range)},a}();c.ScaleMappingFunction=t;var u=function(){function a(a,b){void 0===a&&(a=[0,1]),void 0===b&&(b="return this.linear(value,this.value_min,this.value_max);"),this.domain_=a,this.code_=b,this.f=new Function("value",b)}return Object.defineProperty(a.prototype,"domain",{get:function(){return this.domain_},set:function(a){this.domain_=a},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"code",{get:function(){return this.code_},set:function(a){this.code_!==a&&(this.code_=a,this.f=new Function("value",a))},enumerable:!0,configurable:!0}),a.prototype.apply=function(a){var b=this.domain_[0],c=this.domain_[this.domain_.length-1],d=this.f.call({value_min:b,value_max:c,value_range:c-b,value_domain:this.domain_.slice(),linear:function(a,b,c){return(a-b)/(c-b)}},a);return"number"==typeof d?Math.max(Math.min(d,1),0):NaN},a.prototype.dump=function(){return{type:"script",code:this.code}},a.prototype.eq=function(b){if(!(b instanceof a))return!1;var c=b;return c.code===this.code},a.prototype.restore=function(a){this.code=a.code},a.prototype.clone=function(){return new a(this.domain,this.code)},a}();c.ScriptMappingFunction=u,c.createMappingFunction=k;var v=function(a){function b(b,c){a.call(this,b,c),this.missingValue=0,this.filter_={min:-(1/0),max:1/0},c.map?this.mapping=k(c.map):c.domain&&(this.mapping=new t(c.domain,"linear",c.range||[0,1])),this.original=this.mapping.clone()}return n(b,a),b.prototype.init=function(a){var b=this,c=this.mapping.domain;return isNaN(c[0])||isNaN(c[1])?a(this.desc).then(function(a){return b.mapping.domain=[a.min,a.max],b.original.domain=[a.min,a.max],!0}):Promise.resolve(!0)},b.prototype.dump=function(b){var c=a.prototype.dump.call(this,b);return c.map=this.mapping.dump(),c.filter=this.filter,c.missingValue=this.missingValue,c},b.prototype.restore=function(b,c){a.prototype.restore.call(this,b,c),b.map?this.mapping=k(b.map):b.domain&&(this.mapping=new t(b.domain,"linear",b.range||[0,1])),b.filter&&(this.filter_=b.filter),b.missingValue&&(this.missingValue=b.missingValue)},b.prototype.createEventList=function(){return a.prototype.createEventList.call(this).concat(["mappingChanged"])},b.prototype.getLabel=function(b){return""+a.prototype.getValue.call(this,b)},b.prototype.getRawValue=function(b){var c=a.prototype.getValue.call(this,b);return"undefined"==typeof c||null==c||isNaN(c)||""===c||"NA"===c||"string"==typeof c&&"na"===c.toLowerCase()?this.missingValue:+c},b.prototype.getValue=function(a){var b=this.getRawValue(a);return isNaN(b)?b:this.mapping.apply(b)},b.prototype.getNumber=function(a){return this.getValue(a)},b.prototype.compare=function(a,b){return e(this.getValue(a),this.getValue(b))},b.prototype.getOriginalMapping=function(){return this.original.clone()},b.prototype.getMapping=function(){return this.mapping.clone()},b.prototype.setMapping=function(a){this.mapping.eq(a)||this.fire(["mappingChanged","dirtyValues","dirty"],this.mapping.clone(),this.mapping=a)},b.prototype.isFiltered=function(){return isFinite(this.filter_.min)||isFinite(this.filter_.max)},Object.defineProperty(b.prototype,"filterMin",{get:function(){return this.filter_.min},set:function(a){var b={min:this.filter_.min,max:this.filter_.max};this.filter_.min=isNaN(a)?-(1/0):a,this.fire(["filterChanged","dirtyValues","dirty"],b,this.filter_)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"filterMax",{get:function(){return this.filter_.max},set:function(a){var b={min:this.filter_.min,max:this.filter_.max};this.filter_.max=isNaN(a)?1/0:a,this.fire(["filterChanged","dirtyValues","dirty"],b,this.filter_)},enumerable:!0,configurable:!0}),b.prototype.getFilter=function(){return this.filter_},b.prototype.setFilter=function(a,b){void 0===a&&(a=-(1/0)),void 0===b&&(b=+(1/0));var c={min:this.filter_.min,max:this.filter_.max};this.filter_.min=isNaN(a)?-(1/0):a,this.filter_.max=isNaN(b)?1/0:b,this.fire(["filterChanged","dirtyValues","dirty"],c,this.filter_)},b.prototype.filter=function(a){if(!this.isFiltered())return!0;var b=this.getRawValue(a);return isNaN(b)?!0:!(isFinite(this.filter_.min)&&b<this.filter_.min||isFinite(this.filter_.max)&&b<this.filter_.max)},b}(r);c.NumberColumn=v;var w=function(a){function b(b,c){a.call(this,b,c),this.filter_=null,this._alignment="left",this.setWidthImpl(200),this._alignment=c.alignment||"left"}return n(b,a),Object.defineProperty(b.prototype,"alignment",{get:function(){return this._alignment},enumerable:!0,configurable:!0}),b.prototype.getValue=function(b){var c=a.prototype.getValue.call(this,b);return"undefined"==typeof c||null==c?"":c},b.prototype.dump=function(b){var c=a.prototype.dump.call(this,b);return this.filter_ instanceof RegExp?c.filter="REGEX:"+this.filter_.source:c.filter=this.filter_,c.alignment=this.alignment,c},b.prototype.restore=function(b,c){a.prototype.restore.call(this,b,c),b.filter&&"REGEX:"===b.filter.slice(0,6)?this.filter_=new RegExp(b.filter.slice(6)):this.filter_=b.filter||null,this._alignment=b.alignment||this._alignment},b.prototype.isFiltered=function(){return null!=this.filter_},b.prototype.filter=function(a){if(!this.isFiltered())return!0;var b=this.getLabel(a),c=this.filter_;return"string"==typeof c&&c.length>0?b&&b.toLowerCase().indexOf(c.toLowerCase())>=0:c instanceof RegExp?b&&c.test(b):!0},b.prototype.getFilter=function(){return this.filter_},b.prototype.setFilter=function(a){""===a&&(a=null),this.fire(["filterChanged","dirtyValues","dirty"],this.filter_,this.filter_=a)},b.prototype.compare=function(a,b){return o.ascending(this.getValue(a),this.getValue(b))},b}(r);c.StringColumn=w;var x=function(a){function b(b,c){a.call(this,b,c),this.link=null,this.link=c.link}return n(b,a),Object.defineProperty(b.prototype,"headerCssClass",{get:function(){return null==this.link?"link":"link link_pattern"},enumerable:!0,configurable:!0}),b.prototype.createEventList=function(){return a.prototype.createEventList.call(this).concat(["linkChanged"])},b.prototype.setLink=function(a){a!=this.link&&this.fire(["linkChanged","dirtyHeader","dirtyValues","dirty"],this.link,this.link=a)},b.prototype.getLink=function(){return this.link||""},b.prototype.dump=function(b){var c=a.prototype.dump.call(this,b);return this.link!=this.desc.link&&(c.link=this.link),c},b.prototype.restore=function(b,c){a.prototype.restore.call(this,b,c),b.link&&(this.link=b.link)},b.prototype.getLabel=function(b){var c=a.prototype.getValue.call(this,b);return c.alt?c.alt:""+c},b.prototype.isLink=function(b){if(this.link)return!0;var c=a.prototype.getValue.call(this,b);return null!=c.href},b.prototype.getValue=function(b){var c=a.prototype.getValue.call(this,b);return c.href?c.href:this.link?this.link.replace(/\$1/g,c):c},b}(w);c.LinkColumn=x;var y=function(a){function b(b,c){a.call(this,b,c),this.annotations=o.map()}return n(b,a),b.prototype.getValue=function(b){var c=String(b._index);return this.annotations.has(c)?this.annotations.get(c):a.prototype.getValue.call(this,b)},b.prototype.dump=function(b){var c=a.prototype.dump.call(this,b);return c.annotations={},this.annotations.forEach(function(a,b){c.annotations[a]=b}),c},b.prototype.restore=function(b,c){var d=this;a.prototype.restore.call(this,b,c),b.annotations&&Object.keys(b.annotations).forEach(function(a){d.annotations.set(a,b.annotations[a])})},b.prototype.setValue=function(a,b){var c=this.getValue(a);return c===b?!0:(""===b||null==b?this.annotations.remove(String(a._index)):this.annotations.set(String(a._index),b),this.fire(["dirtyValues","dirty"],b,c),!0)},b}(w);c.AnnotateColumn=y;var z=function(a){function b(b,c){a.call(this,b,c),this.colors=o.scale.category10(),this.filter_=null,this.separator=";",this.separator=c.separator||this.separator,this.initCategories(c)}return n(b,a),b.prototype.initCategories=function(a){if(a.categories){var b=[],c=this.colors.range();a.categories.forEach(function(a,d){"string"==typeof a?b.push(a):(b.push(a.name),c[d]=a.color)}),this.colors.domain(b).range(c)}},Object.defineProperty(b.prototype,"categories",{get:function(){return this.colors.domain()},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"categoryColors",{get:function(){return this.colors.range()},enumerable:!0,configurable:!0}),b.prototype.colorOf=function(a){return this.colors(a)},b.prototype.getLabel=function(a){return""+w.prototype.getValue.call(this,a)},b.prototype.getFirstLabel=function(a){var b=this.getLabels(a);return b.length>0?b[0]:null},b.prototype.getLabels=function(a){var b=w.prototype.getValue.call(this,a),c=b.split(this.separator);return c},b.prototype.getValue=function(a){var b=this.getValues(a);return b.length>0?b[0]:null},b.prototype.getValues=function(a){var b=w.prototype.getValue.call(this,a),c=b.split(this.separator);return c},b.prototype.getCategories=function(a){return this.getValues(a)},b.prototype.getColor=function(a){var b=this.getFirstLabel(a);return null===b||""===b?null:this.colors(b)},b.prototype.getColors=function(a){return this.getLabels(a).map(this.colors)},b.prototype.dump=function(b){var c=a.prototype.dump.call(this,b);return c.filter=this.filter_,c.colors={domain:this.colors.domain(),range:this.colors.range(),separator:this.separator},c},b.prototype.restore=function(b,c){a.prototype.restore.call(this,b,c),this.filter_=b.filter||null,b.colors&&this.colors.domain(b.colors.domain).range(b.colors.range),this.separator=b.separator||this.separator},b.prototype.isFiltered=function(){return null!=this.filter_},b.prototype.filter=function(a){if(!this.isFiltered())return!0;var b=this.getValues(a),c=this.filter_;return b.every(function(a){return Array.isArray(c)&&c.length>0?c.indexOf(a)>=0:"string"==typeof c&&c.length>0?a&&a.toLowerCase().indexOf(c.toLowerCase())>=0:c instanceof RegExp?null!=a&&a.match(c).length>0:!0})},b.prototype.getFilter=function(){return this.filter_},b.prototype.setFilter=function(a){this.fire(["filterChanged","dirtyValues","dirty"],this,this.filter_,this.filter_=a)},b.prototype.compare=function(a,b){for(var c=this.getValues(a),d=this.getValues(b),e=0;e<Math.min(c.length,d.length);++e){var f=o.ascending(c[e],d[e]);if(0!==f)return f}return c.length-d.length},b}(r);c.CategoricalColumn=z;var A=function(a){function b(b,c){if(a.call(this,b,c),this.colors=o.scale.category10(),this.scale=o.scale.ordinal().rangeRoundPoints([0,1]),this.filter_=null,this.separator=";",this.combiner=o.max,this.separator=c.separator||this.separator,z.prototype.initCategories.call(this,c),this.scale.domain(this.colors.domain()),c.categories){var d=[];c.categories.forEach(function(a){"string"!=typeof a&&"number"==typeof a.value?d.push(a.value):d.push(.5)}),this.scale.range(d)}}return n(b,a),b.prototype.createEventList=function(){return a.prototype.createEventList.call(this).concat(["mappingChanged"])},Object.defineProperty(b.prototype,"categories",{get:function(){return this.colors.domain()},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"categoryColors",{get:function(){return this.colors.range()},enumerable:!0,configurable:!0}),b.prototype.colorOf=function(a){return this.colors(a)},b.prototype.getLabel=function(a){return z.prototype.getLabel.call(this,a)},b.prototype.getFirstLabel=function(a){return z.prototype.getFirstLabel.call(this,a)},b.prototype.getLabels=function(a){return z.prototype.getLabels.call(this,a)},b.prototype.getValue=function(a){var b=this.getValues(a);return b.length>0?this.combiner(b):0},b.prototype.getValues=function(a){var b=z.prototype.getValues.call(this,a);return b.map(this.scale)},b.prototype.getCategories=function(a){return z.prototype.getValues.call(this,a)},b.prototype.getNumber=function(a){return this.getValue(a)},b.prototype.getColor=function(a){var b=this.getValues(a),c=this.getColors(a);return this.combiner===o.max?c.slice(1).reduce(function(a,c,d){return b[d+1]>a.v?{c:c,v:b[d+1]}:a},{c:c[0],v:b[0]}).c:this.combiner===o.min?c.slice(1).reduce(function(a,c,d){return b[d+1]<a.v?{c:c,v:b[d+1]}:a},{c:c[0],v:b[0]}).c:c[0]||null},b.prototype.getColors=function(a){return z.prototype.getColors.call(this,a)},b.prototype.dump=function(a){var b=z.prototype.dump.call(this,a);return b.scale={domain:this.scale.domain(),range:this.scale.range(),separator:this.separator},b},b.prototype.restore=function(a,b){z.prototype.restore.call(this,a,b),a.scale&&this.scale.domain(a.scale.domain).range(a.scale.range),this.separator=a.separator||this.separator},b.prototype.getScale=function(){return{domain:this.scale.domain(),range:this.scale.range()}},b.prototype.setRange=function(a){var b=this.getScale();this.scale.range(a),this.fire(["mappingChanged","dirtyValues","dirty"],b,this.getScale())},b.prototype.isFiltered=function(){return null!=this.filter_},b.prototype.filter=function(a){return z.prototype.filter.call(this,a)},b.prototype.getFilter=function(){return this.filter_},b.prototype.setFilter=function(a){this.fire(["filterChanged","dirtyValues","dirty"],this.filter_,this.filter_=a)},b.prototype.compare=function(a,b){return v.prototype.compare.call(this,a,b)},b}(r);c.CategoricalNumberColumn=A;var B=function(a){function b(b,c){a.call(this,b,c),this.missingValue=0,this.children_=[],this._collapsed=!1;var d=this;this.adaptChange=function(a,b){d.adaptWidthChange(this.source,a,b)}}return n(b,a),b.desc=function(a){return void 0===a&&(a="Combined"),{type:"stack",label:a}},b.prototype.createEventList=function(){return a.prototype.createEventList.call(this).concat(["collapseChanged"])},b.prototype.assignNewId=function(b){a.prototype.assignNewId.call(this,b),this.children_.forEach(function(a){return a.assignNewId(b)})},Object.defineProperty(b.prototype,"children",{get:function(){return this.children_.slice()},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"length",{get:function(){return this.children_.length},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"weights",{get:function(){var a=this.getWidth();return this.children_.map(function(b){return b.getWidth()/a})},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"collapsed",{
get:function(){return this._collapsed},set:function(a){this._collapsed!==a&&this.fire(["collapseChanged","dirtyHeader","dirtyValues","dirty"],this._collapsed,this._collapsed=a)},enumerable:!0,configurable:!0}),b.prototype.flatten=function(a,b,c,d){void 0===c&&(c=0),void 0===d&&(d=0);var e=null;if(0===c||c<=q.FLAT_ALL_COLUMNS){var f=this.compressed?q.COMPRESSED_WIDTH:this.getWidth();if(this.collapsed||this.compressed||(f+=(this.children_.length-1)*d),a.push(e={col:this,offset:b,width:f}),0===c)return f}var g=b;return this.children_.forEach(function(b){g+=b.flatten(a,g,c-1,d)+d}),e&&(e.width=g-b-d),g-b-d},b.prototype.dump=function(b){var c=a.prototype.dump.call(this,b);return c.children=this.children_.map(function(a){return a.dump(b)}),c.missingValue=this.missingValue,c.collapsed=this.collapsed,c},b.prototype.restore=function(b,c){var d=this;b.missingValue&&(this.missingValue=b.missingValue),b.children.map(function(a){var b=c(a);b&&d.push(b)}),this.collapsed=b.collapsed===!0,a.prototype.restore.call(this,b,c)},b.prototype.insert=function(b,c,d){return void 0===d&&(d=NaN),f(b)?(isNaN(d)||b.setWidth(d/(1-d)*this.getWidth()),this.children_.splice(c,0,b),b.parent=this,this.forward(b,"dirtyHeader.stack","dirtyValues.stack","dirty.stack","filterChanged.stack"),b.on("widthChanged.stack",this.adaptChange),a.prototype.setWidth.call(this,1===this.children_.length?b.getWidth():this.getWidth()+b.getWidth()),this.fire(["addColumn","dirtyHeader","dirtyValues","dirty"],b,b.getWidth()/this.getWidth(),c),!0):null},b.prototype.push=function(a,b){return void 0===b&&(b=NaN),this.insert(a,this.children_.length,b)},b.prototype.indexOf=function(a){var b=-1;return this.children_.some(function(c,d){return c===a?(b=d,!0):!1}),b},b.prototype.insertAfter=function(a,b,c){void 0===c&&(c=NaN);var d=this.indexOf(b);return 0>d?!1:this.insert(a,d+1,c)},b.prototype.adaptWidthChange=function(a,b,c){if(b!==c){var d=this.getWidth(),e=(c-b)/d,f=b/d,g=(1-f-e)/(1-f);this.children_.forEach(function(b){b===a||b.setWidthImpl(b.getWidth()*g)}),this.fire(["widthChanged","dirtyHeader","dirtyValues","dirty"],d,d)}},b.prototype.setWeights=function(a){var b,c=a.length-this.length;if(0>c)if(b=o.sum(a),1>=b)for(var d=0;-c>d;++d)a.push((1-b)*(1/-c));else if(100>=b)for(var d=0;-c>d;++d)a.push((100-b)*(1/-c));a=a.slice(0,this.length),b=o.sum(a)/this.getWidth(),a=a.map(function(a){return a/b}),this.children_.forEach(function(b,c){b.setWidthImpl(a[c])}),this.fire(["widthChanged","dirtyHeader","dirtyValues","dirty"],this.getWidth(),this.getWidth())},b.prototype.remove=function(b){var c=this.children_.indexOf(b);return 0>c?!1:(this.children_.splice(c,1),b.parent=null,this.unforward(b,"dirtyHeader.stack","dirtyValues.stack","dirty.stack","filterChanged.stack"),b.on("widthChanged.stack",null),a.prototype.setWidth.call(this,0===this.length?100:this.getWidth()-b.getWidth()),this.fire(["removeColumn","dirtyHeader","dirtyValues","dirty"],b),!0)},b.prototype.setWidth=function(b){var c=b/this.getWidth();this.children_.forEach(function(a){a.setWidthImpl(a.getWidth()*c)}),a.prototype.setWidth.call(this,b)},b.prototype.getValue=function(a){var b=this.getWidth(),c=this.children_.reduce(function(c,d){return c+d.getValue(a)*(d.getWidth()/b)},0);return"undefined"==typeof c||null==c||isNaN(c)?this.missingValue:c},b.prototype.getNumber=function(a){return this.getValue(a)},b.prototype.compare=function(a,b){return e(this.getValue(a),this.getValue(b))},b.prototype.isFiltered=function(){return this.children_.some(function(a){return a.isFiltered()})},b.prototype.filter=function(a){return this.children_.every(function(b){return b.filter(a)})},b}(q);c.StackColumn=B;var C=function(a){function b(b,c){var d=this;a.call(this,b,c),this.sortBy_=null,this.ascending=!1,this.columns_=[],this.comparator=function(a,b){if(null===d.sortBy_)return 0;var c=d.sortBy_.compare(a,b);return d.ascending?c:-c},this.dirtyOrder=function(){d.fire(["dirtyOrder","dirtyValues","dirty"],d.sortCriteria())},this.order=[],this.setWidthImpl(50)}return n(b,a),b.prototype.createEventList=function(){return a.prototype.createEventList.call(this).concat(["sortCriteriaChanged","dirtyOrder","orderChanged"])},b.prototype.assignNewId=function(b){a.prototype.assignNewId.call(this,b),this.columns_.forEach(function(a){return a.assignNewId(b)})},b.prototype.setOrder=function(a){this.fire(["orderChanged","dirtyValues","dirty"],this.order,this.order=a)},b.prototype.getOrder=function(){return this.order},b.prototype.dump=function(b){var c=a.prototype.dump.call(this,b);return c.columns=this.columns_.map(function(a){return a.dump(b)}),c.sortCriteria={asc:this.ascending},this.sortBy_&&(c.sortCriteria.sortBy=this.sortBy_.id),c},b.prototype.restore=function(b,c){var d=this;if(a.prototype.restore.call(this,b,c),b.columns.map(function(a){var b=c(a);b&&d.push(b)}),b.sortCriteria&&(this.ascending=b.sortCriteria.asc,b.sortCriteria.sortBy)){var e=this.columns_.filter(function(a){return a.id===b.sortCriteria.sortBy});this.sortBy(0===e.length?null:e[0],b.sortCriteria.asc)}},b.prototype.flatten=function(a,b,c,d){void 0===c&&(c=0),void 0===d&&(d=0),a.push({col:this,offset:b,width:this.getWidth()});var e=b+this.getWidth()+d;return(c>0||c<=q.FLAT_ALL_COLUMNS)&&this.columns_.forEach(function(b){e+=b.flatten(a,e,c-1,d)+d}),e-b},b.prototype.sortCriteria=function(){return{col:this.sortBy_,asc:this.ascending}},b.prototype.sortByMe=function(a){return void 0===a&&(a=!1),!1},b.prototype.toggleMySorting=function(){return!1},b.prototype.findMyRanker=function(){return this},b.prototype.insertAfterMe=function(a){return null!==this.insert(a,0)},b.prototype.toggleSorting=function(a){return this.sortBy_===a?this.sortBy(a,!this.ascending):this.sortBy(a)},b.prototype.sortBy=function(a,b){if(void 0===b&&(b=!1),null!==a&&a.findMyRanker()!==this)return!1;if(this.sortBy_===a&&this.ascending===b)return!0;this.sortBy_&&this.sortBy_.on("dirtyValues.order",null);var c=this.sortCriteria();return this.sortBy_=a,this.sortBy_&&this.sortBy_.on("dirtyValues.order",this.dirtyOrder),this.ascending=b,this.fire(["sortCriteriaChanged","dirtyOrder","dirtyHeader","dirtyValues","dirty"],c,this.sortCriteria()),!0},Object.defineProperty(b.prototype,"children",{get:function(){return this.columns_.slice()},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"length",{get:function(){return this.columns_.length},enumerable:!0,configurable:!0}),b.prototype.insert=function(a,b){return void 0===b&&(b=this.columns_.length),this.columns_.splice(b,0,a),a.parent=this,this.forward(a,"dirtyValues.ranking","dirtyHeader.ranking","dirty.ranking","filterChanged.ranking"),a.on("filterChanged.order",this.dirtyOrder),this.fire(["addColumn","dirtyHeader","dirtyValues","dirty"],a,b),null===this.sortBy_&&this.sortBy(a),a},b.prototype.insertAfter=function(a,b){if(b===this)return null!=this.insert(a,0);var c=this.columns_.indexOf(b);return 0>c?!1:null!=this.insert(a,c+1)},b.prototype.push=function(a){return this.insert(a)},b.prototype.remove=function(a){var b=this.columns_.indexOf(a);return 0>b?!1:(this.unforward(a,"dirtyValues.ranking","dirtyHeader.ranking","dirty.ranking","filterChanged.ranking"),a.parent=null,this.columns_.splice(b,1),this.fire(["removeColumn","dirtyHeader","dirtyValues","dirty"],a),this.sortBy_===a&&this.sortBy(this.columns_.length>0?this.columns_[0]:null),!0)},Object.defineProperty(b.prototype,"flatColumns",{get:function(){var a=[];return this.flatten(a,0,q.FLAT_ALL_COLUMNS),a.map(function(a){return a.col})},enumerable:!0,configurable:!0}),b.prototype.find=function(a){for(var b="string"==typeof a?function(b){return b.id===a}:a,c=this.flatColumns,d=0;d<c.length;++d)if(b(c[d]))return c[d];return null},b.prototype.toSortingDesc=function(a){var b=function(c){if(null===c)return null;if(c instanceof B){var d=c.weights;return c.children.map(function(a,c){return{weight:d[c],id:b(a)}})}return a(c.desc)},c=b(this.sortBy_);return null===c?null:{id:c,asc:this.ascending}},b.prototype.isFiltered=function(){return this.columns_.some(function(a){return a.isFiltered()})},b.prototype.filter=function(a){return this.columns_.every(function(b){return b.filter(a)})},b}(r);c.RankColumn=C,c.createStackDesc=B.desc,c.createActionDesc=l,c.models=m},{"./utils":8,d3:void 0}],4:[function(a,b,c){function d(a,b,c){if(0===a.length)return{min:NaN,max:NaN,mean:NaN,count:0,maxBin:0,hist:[]};var d=i.layout.histogram().value(b);c&&d.range(function(){return c});var e=i.extent(a,b),f=d(a);return{min:e[0],max:e[1],mean:i.mean(a,b),count:a.length,maxBin:i.max(f,function(a){return a.y}),hist:f}}function e(a,b,c){var d=i.map();return c.forEach(function(a){return d.set(a,0)}),a.forEach(function(a){var c=b(a);null!=c&&c.forEach(function(a){d.set(a,(d.get(a)||0)+1)})}),{maxBin:i.max(d.values()),hist:d.entries().map(function(a){return{cat:a.key,y:a.value}})}}var f=this&&this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);a.prototype=null===b?Object.create(b):(c.prototype=b.prototype,new c)},g=a("./model"),h=a("./utils"),i=a("d3"),j=function(a){function b(){a.call(this),this.rankings_=[],this.selection=i.set(),this.uid=0,this.columnTypes=g.models();var b=this;this.reorder=function(){b.triggerReorder(this.source)}}return f(b,a),b.prototype.createEventList=function(){return a.prototype.createEventList.call(this).concat(["addColumn","removeColumn","addRanking","removeRanking","dirty","dirtyHeader","dirtyValues","orderChanged","selectionChanged"])},b.prototype.getColumns=function(){return[]},b.prototype.pushRanking=function(a){var b=this.cloneRanking(a);return this.pushRankingImpl(b),b},b.prototype.pushRankingImpl=function(a){this.rankings_.push(a),this.forward(a,"addColumn.provider","removeColumn.provider","dirty.provider","dirtyHeader.provider","orderChanged.provider","dirtyValues.provider"),a.on("dirtyOrder.provider",this.reorder),this.fire(["addRanking","dirtyHeader","dirtyValues","dirty"],a)},b.prototype.triggerReorder=function(a){this.sort(a).then(function(b){return a.setOrder(b)})},b.prototype.removeRanking=function(a){var b=this.rankings_.indexOf(a);return 0>b?!1:(this.unforward(a,"addColumn.provider","removeColumn.provider","dirty.provider","dirtyHeader.provider","orderChanged.provider","dirtyOrder.provider","dirtyValues.provider"),this.rankings_.splice(b,1),a.on("dirtyOrder.provider",null),this.cleanUpRanking(a),this.fire(["removeRanking","dirtyHeader","dirtyValues","dirty"],a),!0)},b.prototype.clearRankings=function(){var a=this;this.rankings_.forEach(function(b){a.unforward(b,"addColumn.provider","removeColumn.provider","dirty.provider","dirtyHeader.provider","dirtyOrder.provider","dirtyValues.provider"),b.on("dirtyOrder.provider",null),a.cleanUpRanking(b)}),this.rankings_=[],this.fire(["removeRanking","dirtyHeader","dirtyValues","dirty"])},b.prototype.getRankings=function(){return this.rankings_.slice()},b.prototype.getLastRanking=function(){return this.rankings_[this.rankings_.length-1]},b.prototype.cleanUpRanking=function(a){},b.prototype.cloneRanking=function(a){return null},b.prototype.push=function(a,b){var c=this.create(b);return c?(a.push(c),c):null},b.prototype.insert=function(a,b,c){var d=this.create(c);return d?(a.insert(d,b),d):null},b.prototype.nextId=function(){return"col"+this.uid++},b.prototype.create=function(a){var b=this.columnTypes[a.type];return b?new b(this.nextId(),a):null},b.prototype.clone=function(a){var b=a.dump(function(a){return a});return this.restoreColumn(b)},b.prototype.restoreColumn=function(a){var b=this,c=function(a){var d=b.columnTypes[a.desc.type],e=new d("",a.desc);return e.restore(a,c),e.assignNewId(b.nextId.bind(b)),e};return c(a)},b.prototype.find=function(a){for(var b="string"==typeof a?function(b){return b.id===a}:a,c=0;c<this.rankings_.length;++c){var d=this.rankings_[c].find(b);if(d)return d}return null},b.prototype.dump=function(){var a=this;return{uid:this.uid,selection:this.selection.values().map(Number),rankings:this.rankings_.map(function(b){return b.dump(a.toDescRef)})}},b.prototype.dumpColumn=function(a){return a.dump(this.toDescRef)},b.prototype.toDescRef=function(a){return a},b.prototype.fromDescRef=function(a){return a},b.prototype.restore=function(a){var b=this,c=function(a){var d=b.fromDescRef(a.desc),e=null;if(d&&d.type){var f=b.columnTypes[d.type];e=new f(a.id,d),e.restore(a,c)}return e};this.clearRankings(),this.uid=a.uid||0,a.selection&&a.selection.forEach(function(a){return b.selection.add(String(a))}),a.rankings&&a.rankings.forEach(function(a){var d=b.pushRanking();d.restore(a,c)}),a.layout&&Object.keys(a.layout).forEach(function(c){b.deriveRanking(a.layout[c])});var d=this.nextId.bind(this);this.rankings_.forEach(function(a){a.children.forEach(function(a){return a.assignNewId(d)})})},b.prototype.findDesc=function(a){return null},b.prototype.deriveDefault=function(){var a=this;if(!(this.rankings_.length>0)){var b=this.pushRanking();this.getColumns().forEach(function(c){a.push(b,c)})}},b.prototype.deriveRanking=function(a){var b=this,c=function(a){if("rank"===a.type)return null;if("actions"===a.type){var d=b.create(g.createActionDesc(a.label||"actions"));return d.restore(a,null),d}if("stacked"===a.type){var e=b.create(g.StackColumn.desc(a.label||"Combined"));return(a.children||[]).forEach(function(a){var b=c(a);b&&e.push(b)}),e}var f=b.findDesc(a.column);if(f){var h=b.create(f);return a.label=a.label||f.label||f.column,h.restore(a,null),h}return null},d=this.pushRanking();return a.forEach(function(a){var b=c(a);b&&d.push(b)}),d},b.prototype.sort=function(a){return Promise.reject("not implemented")},b.prototype.view=function(a){return Promise.reject("not implemented")},b.prototype.mappingSample=function(a){return Promise.reject("not implemented")},b.prototype.stats=function(a){return{stats:function(a){return Promise.reject("not implemented")},hist:function(a){return Promise.reject("not implemented")}}},b.prototype.rowKey=function(a,b){return"number"==typeof a?String(a):String(a._index)},b.prototype.isSelected=function(a){return this.selection.has(String(a))},b.prototype.select=function(a){this.selection.add(String(a)),this.fire("selectionChanged",this.selection.values().map(Number))},b.prototype.searchSelect=function(a,b){},b.prototype.selectAll=function(a){var b=this;a.forEach(function(a){b.selection.add(String(a))}),this.fire("selectionChanged",this.selection.values().map(Number))},b.prototype.setSelection=function(a){var b=this;this.selection.size()===a.length&&a.every(function(a){return b.selection.has(String(a))})||(this.selection=i.set(),this.selectAll(a))},b.prototype.toggleSelection=function(a,b){return void 0===b&&(b=!1),this.isSelected(a)?(b?this.deselect(a):this.clearSelection(),!1):(b?this.select(a):this.setSelection([a]),!0)},b.prototype.deselect=function(a){this.selection.remove(String(a)),this.fire("selectionChanged",this.selection.values().map(Number))},b.prototype.selectedRows=function(){return this.selection.empty()?Promise.resolve([]):this.view(this.getSelection())},b.prototype.getSelection=function(){var a=[];return this.selection.forEach(function(b){return a.push(+b)}),a.sort(),a},b.prototype.clearSelection=function(){this.selection=i.set(),this.fire("selectionChanged",[])},b.prototype.exportTable=function(a,b){function c(a,b){return!d.quote||b&&g.isNumberColumn(b)?a:d.quoteChar+a+d.quoteChar}void 0===b&&(b={});var d={separator:"	",newline:"\n",header:!0,quote:!1,quoteChar:'"'};h.merge(d,b);var e=a.flatColumns;return this.view(a.getOrder()).then(function(a){var b=[];return d.header&&b.push(e.map(function(a){return c(a.label)}).join(d.separator)),a.forEach(function(a){b.push(e.map(function(b){return c(b.getLabel(a),b)}).join(d.separator))}),b.join(d.newline)})},b}(h.AEventDispatcher);c.DataProvider=j;var k=function(a){function b(b){var c=this;void 0===b&&(b=[]),a.call(this),this.columns=b,this.rankingIndex=0,this.rowGetter=function(a,b,c){return a[c.column]},this.columns=b.slice(),b.forEach(function(a){a.accessor=c.rowGetter,a.label=a.label||a.column})}return f(b,a),b.prototype.createEventList=function(){return a.prototype.createEventList.call(this).concat(["addDesc"])},b.prototype.pushDesc=function(a){var b=a;b.accessor=this.rowGetter,b.label=a.label||b.column,this.columns.push(a),this.fire("addDesc",b)},b.prototype.getColumns=function(){return this.columns.slice()},b.prototype.findDesc=function(a){return this.columns.filter(function(b){return b.column===a})[0]},b.prototype.toDescRef=function(a){return a.column?a.type+"@"+a.column:a},b.prototype.fromDescRef=function(a){return"string"==typeof a?this.columns.filter(function(b){return b.type+"@"+b.column===a})[0]:a},b.prototype.restore=function(b){a.prototype.restore.call(this,b),this.rankingIndex=1+i.max(this.getRankings(),function(a){return+a.id.substring(4)})},b.prototype.nextRankingId=function(){return"rank"+this.rankingIndex++},b}(j);c.CommonDataProvider=k;var l=function(a){function b(b,c,d){void 0===c&&(c=[]),void 0===d&&(d={}),a.call(this,c),this.data=b,this.options={filterGlobally:!1},h.merge(this.options,d),b.forEach(function(a,b){a._rankings={},a._index=b});var e=this;this.reorderall=function(){var a=this.source;e.getRankings().forEach(function(b){b!==a&&b.dirtyOrder()})}}return f(b,a),b.prototype.cloneRanking=function(a){var b=this,c=this.nextRankingId(),d={label:"Rank",type:"rank",accessor:function(a,b){return a._rankings[b]+1||1}},e=new g.RankColumn(c,d);return a&&(this.data.forEach(function(b){var d=b._rankings;d[c]=d[a.id]}),a.children.forEach(function(a){b.push(e,a.desc)})),this.options.filterGlobally&&e.on("filterChanged.reorderall",this.reorderall),e},b.prototype.cleanUpRanking=function(a){this.options.filterGlobally&&a.on("filterChanged.reorderall",null),this.data.forEach(function(b){return delete b._rankings[a.id]})},b.prototype.sort=function(a){var b=this.data.map(function(b,c){return{row:b,i:c,prev:b._rankings[a.id]||0}});if(this.options.filterGlobally){var c=this.getRankings().filter(function(a){return a.isFiltered()});c.length>0&&(b=b.filter(function(a){return c.every(function(b){return b.filter(a.row)})}))}else a.isFiltered()&&(b=b.filter(function(b){return a.filter(b.row)}));b.sort(function(b,c){return a.comparator(b.row,c.row)});var d=b.map(function(b,c){return b.row._rankings[a.id]=c,b.i});return Promise.resolve(d)},b.prototype.view=function(a){var b=this,c=a.map(function(a){return b.data[a]});return Promise.resolve(c)},b.prototype.stats=function(a){var b=this,c=null,f=function(){return null===c?c=b.view(a):c};return{stats:function(a){return f().then(function(b){return d(b,a.getNumber.bind(a),[0,1])})},hist:function(a){return f().then(function(b){return e(b,a.getCategories.bind(a),a.categories)})}}},b.prototype.mappingSample=function(a){return Promise.resolve(this.data.map(a.getRawValue.bind(a)))},b.prototype.searchSelect=function(a,b){var c="string"==typeof a?function(b){return b.indexOf(a)>=0}:function(b){return null!=b.match(a)},d=this.data.filter(function(a){return c(b.getLabel(a))}).map(function(a){return a._index});this.setSelection(d)},b}(k);c.LocalDataProvider=l;var m=function(a){function b(b,c){void 0===c&&(c=[]),a.call(this,c),this.server=b,this.ranks={}}return f(b,a),b.prototype.cloneRanking=function(a){var b=this,c=this.nextRankingId(),d={label:"Rank",type:"rank",accessor:function(a,c){return b.ranks[c][a._index]||0}};return a&&(this.ranks[c]=this.ranks[a.id]),new g.RankColumn(c,d)},b.prototype.cleanUpRanking=function(a){delete this.ranks[a.id]},b.prototype.sort=function(a){var b=this,c=a.toSortingDesc(function(a){return a.column});return this.server.sort(c).then(function(c){return b.ranks[a.id]=c,c})},b.prototype.view=function(a){return this.server.view(a).then(function(b){return b.forEach(function(b,c){return b._index=a[c]}),b})},b.prototype.mappingSample=function(a){return this.server.mappingSample(a.desc.column)},b.prototype.searchSelect=function(a,b){var c=this;this.server.search(a,b.desc.column).then(function(a){c.setSelection(a)})},b}(k);c.RemoteDataProvider=m},{"./model":3,"./utils":8,d3:void 0}],5:[function(a,b,c){function d(a){return a?new j(a):p}function e(a){return a?new m(a):q}function f(){return{string:new s,link:new r,number:e(),rank:d({textClass:"rank",align:"right"}),heatmap:new l,stack:new u,categorical:new t,ordinal:e({colorOf:function(a,b,c){return c.getColor(a)}}),max:e({colorOf:function(a,b,c){return c.getColor(a)}}),actions:new n,annotate:new o}}var g=this&&this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);a.prototype=null===b?Object.create(b):(c.prototype=b.prototype,new c)},h=a("./model"),i=function(){function a(){this.textClass="text",this.align="left"}return a.prototype.render=function(a,b,c,d){var e=a.datum(b).selectAll("text."+this.textClass).data(c,d.rowKey);e.enter().append("text").attr({"class":this.textClass,"clip-path":"url(#"+d.idPrefix+"clipCol"+b.id+")",y:function(a,b){return d.cellPrevY(b)}});var f=2;"right"===this.align?f=b.getWidth()-5:"center"===this.align&&(f=.5*b.getWidth()),e.attr({x:function(a,b){return d.cellX(b)+f},"data-index":function(a,b){return b}}).text(function(a){return b.getLabel(a)}),d.animated(e).attr({y:function(a,b){return d.cellY(b)}}),e.exit().remove()},a.prototype.findRow=function(a,b){return a.selectAll("text."+this.textClass+'[data-index="'+b+'"]')},a.prototype.mouseEnter=function(a,b,c,d,e,f){var g=b.node(),h=this.findRow(a,e).node();h&&g.appendChild(h)},a.prototype.mouseLeave=function(a,b,c,d,e,f){var g=a.node(),h=b.node();h.hasChildNodes()&&g.appendChild(h.firstChild),b.selectAll("*").remove()},a}();c.DefaultCellRenderer=i;var j=function(a){function b(b){var c=this;a.call(this),Object.keys(b).forEach(function(a){c[a]=b[a]})}return g(b,a),b}(i),k=function(a){function b(){a.apply(this,arguments)}return g(b,a),b.prototype.render=function(a,b,c,d){var e=this,f=a.datum(b).selectAll("rect.bar").data(c,d.rowKey);f.enter().append("rect").attr({"class":"bar "+b.cssClass,x:function(a,b){return d.cellX(b)},y:function(a,b){return d.cellPrevY(b)+d.option("rowPadding",1)},width:function(a){var c=b.getWidth()*b.getValue(a);return isNaN(c)?0:c}}).style("fill",b.color),f.attr({"data-index":function(a,b){return b},height:function(a,b){return d.rowHeight(b)-2*d.option("rowPadding",1)}}),d.animated(f).attr({x:function(a,b){return d.cellX(b)},y:function(a,b){return d.cellY(b)+d.option("rowPadding",1)},width:function(a){var c=b.getWidth()*b.getValue(a);return isNaN(c)?0:c}}).style({fill:function(a,c){return e.colorOf(a,c,b)}}),f.exit().remove()},b.prototype.colorOf=function(a,b,c){return c.color},b.prototype.findRow=function(a,b){return a.selectAll('rect.bar[data-index="'+b+'"]')},b.prototype.mouseEnter=function(a,b,c,d,e,f){var g=this.findRow(a,e);g.empty()||(b.node().appendChild(g.node()),b.append("text").datum(g.datum()).attr({"class":"number","clip-path":"url(#"+f.idPrefix+"clipCol"+c.id+")",transform:"translate("+f.cellX(e)+","+f.cellY(e)+")"}).text(function(a){return c.getLabel(a)}))},b}(i);c.BarCellRenderer=k;var l=function(a){function b(){a.apply(this,arguments)}return g(b,a),b.prototype.render=function(a,b,c,d){var e=this,f=a.datum(b).selectAll("rect.heatmap").data(c,d.rowKey);f.enter().append("rect").attr({"class":"bar "+b.cssClass,x:function(a,b){return d.cellX(b)},y:function(a,b){return d.cellPrevY(b)+d.option("rowPadding",1)},width:function(a,b){return d.rowHeight(b)-2*d.option("rowPadding",1)}}).style("fill",b.color),f.attr({"data-index":function(a,b){return b},width:function(a,b){return d.rowHeight(b)-2*d.option("rowPadding",1)},height:function(a,b){return d.rowHeight(b)-2*d.option("rowPadding",1)}}),d.animated(f).attr({x:function(a,b){return d.cellX(b)},y:function(a,b){return d.cellY(b)+d.option("rowPadding",1)}}).style({fill:function(a,c){return e.colorOf(a,c,b)}}),f.exit().remove()},b.prototype.colorOf=function(a,b,c){var d=c.getValue(a);isNaN(d)&&(d=0);var e=d3.hsl(c.color||h.Column.DEFAULT_COLOR);return e.l=d,e.toString()},b.prototype.findRow=function(a,b){return a.selectAll('rect.heatmap[data-index="'+b+'"]')},b.prototype.mouseEnter=function(a,b,c,d,e,f){var g=this.findRow(a,e);g.empty()||(b.node().appendChild(g.node()),b.append("text").datum(g.datum()).attr({"class":"number","clip-path":"url(#"+f.idPrefix+"clipCol"+c.id+")",transform:"translate("+f.cellX(e)+","+f.cellY(e)+")"}).text(function(a){return c.getLabel(a)}))},b}(i);c.HeatMapCellRenderer=l;var m=function(a){function b(b){var c=this;a.call(this),Object.keys(b).forEach(function(a){c[a]=b[a]})}return g(b,a),b}(k),n=function(){function a(){}return a.prototype.render=function(a,b,c,d){},a.prototype.mouseEnter=function(a,b,c,d,e,f){var g=f.option("actions",[]),h=b.append("text").attr({"class":"actions fa",x:f.cellX(e),y:f.cellPrevY(e),"data-index":e}).selectAll("tspan").data(g);h.enter().append("tspan").text(function(a){return a.icon}).attr("title",function(a){return a.name}).on("click",function(a){d3.event.preventDefault(),d3.event.stopPropagation(),a.action(d)})},a.prototype.mouseLeave=function(a,b,c,d,e,f){b.selectAll("*").remove()},a}();c.ActionCellRenderer=n;var o=function(a){function b(){a.apply(this,arguments)}return g(b,a),b.prototype.mouseEnter=function(a,b,c,d,e,f){this.findRow(a,e).attr("display","none"),b.append("foreignObject").attr({x:f.cellX(e)-2,y:f.cellPrevY(e)-2,"data-index":e,width:c.getWidth(),height:f.rowHeight(e)}).append("xhtml:input").attr({type:"text",value:c.getValue(d)}).style({width:c.getWidth()+"px"}).on("change",function(){var a=this.value;c.setValue(d,a)}).on("click",function(){return d3.event.stopPropagation()})},b.prototype.mouseLeave=function(a,b,c,d,e,f){this.findRow(a,e).attr("display",null);var g=b.select("input").node();g&&c.setValue(d,g.value),b.selectAll("*").remove()},b}(i),p=new i,q=new k;c.defaultRenderer=d,c.barRenderer=e;var r=function(a){function b(){a.apply(this,arguments)}return g(b,a),b.prototype.render=function(a,b,c,d){var e=a.datum(b).selectAll("text.link").data(c,d.rowKey);e.enter().append("text").attr({"class":"text link","clip-path":"url(#"+d.idPrefix+"clipCol"+b.id+")",y:function(a,b){return d.cellPrevY(b)}}),e.attr({x:function(a,b){return d.cellX(b)},"data-index":function(a,b){return b}}).html(function(a){return b.isLink(a)?'<a class="link" xlink:href="'+b.getValue(a)+'" target="_blank">'+b.getLabel(a)+"</a>":b.getLabel(a)}),d.animated(e).attr({y:function(a,b){return d.cellY(b)}}),e.exit().remove()},b.prototype.findRow=function(a,b){return a.selectAll('text.link[data-index="'+b+'"]')},b}(i),s=function(a){function b(){a.apply(this,arguments)}return g(b,a),b.prototype.render=function(b,c,d,e){return this.align=c.alignment,this.textClass="text"+("left"===c.alignment?"":"_"+c.alignment),a.prototype.render.call(this,b,c,d,e)},b}(i),t=function(a){function b(){a.apply(this,arguments),this.textClass="cat"}return g(b,a),b.prototype.render=function(a,b,c,d){var e=a.datum(b).selectAll("g."+this.textClass).data(c,d.rowKey),f=e.enter().append("g").attr({"class":this.textClass,"data-index":function(a,b){return b},transform:function(a,b){return"translate("+d.cellX(b)+","+d.cellPrevY(b)+")"}});f.append("text").attr({"clip-path":"url(#"+d.idPrefix+"clipCol"+b.id+")",x:function(a,b){return d.rowHeight(b)}}),f.append("rect").attr({y:d.option("rowPadding",1)}),e.attr({"data-index":function(a,b){return b},transform:function(a,b){return"translate("+d.cellX(b)+","+d.cellY(b)+")"}}),e.select("text").attr({x:function(a,b){return d.rowHeight(b)}}).text(function(a){return b.getLabel(a)}),e.select("rect").style({fill:function(a){return b.getColor(a)}}).attr({height:function(a,b){return Math.max(d.rowHeight(b)-2*d.option("rowPadding",1),0)},width:function(a,b){return Math.max(d.rowHeight(b)-2*d.option("rowPadding",1),0)}}),d.animated(e).attr({transform:function(a,b){return"translate("+d.cellX(b)+","+d.cellY(b)+")"}}),e.exit().remove()},b.prototype.findRow=function(a,b){return a.selectAll("g."+this.textClass+'[data-index="'+b+'"]')},b}(i),u=function(a){function b(){a.apply(this,arguments)}return g(b,a),b.prototype.renderImpl=function(a,b,c,d,e,f){void 0===f&&(f=!0);var g=a.datum(b),h=b.children,i=0,j=h.map(function(a){var b=i;return i+=a.getWidth(),b}),k="component"+c.option("stackLevel",""),l=c.cellX,m=c.option;c.option=function(a,b){var c=m(a,b);return"stackLevel"===a?c+"N":c};var n=g.selectAll("g."+k).data(h,function(a){return a.id});n.enter().append("g").attr({"class":k,transform:function(a,b){return"translate("+j[b]+",0)"}}),n.attr({"class":function(a){return k+" "+a.desc.type},"data-stack":function(a,b){return b}}).each(function(a,f){if(c.showStacked(b)){var g=h.slice(0,f);c.cellX=function(a){return l(a)-g.reduce(function(b,c){return b+c.getWidth()*(1-c.getValue(e(a)))},0)}}d(d3.select(this),a,f,c)}),(f?c.animated(n):n).attr({transform:function(a,b){return"translate("+j[b]+",0)"}}),n.exit().remove(),c.cellX=l,c.option=m},b.prototype.render=function(a,b,c,d){this.renderImpl(a,b,d,function(a,b,d,e){e.render(b,a,c,e)},function(a){return c[a]})},b.prototype.mouseEnter=function(a,b,c,d,e,f){var g="component"+f.option("stackLevel","");this.renderImpl(b,c,f,function(b,c,f,h){var i=a.select("g."+g+'[data-stack="'+f+'"]');i.empty()||h.renderer(c).mouseEnter(i,b,c,d,e,h)},function(a){return d},!1)},b.prototype.mouseLeave=function(a,b,c,d,e,f){var g="component"+f.option("stackLevel","");this.renderImpl(b,c,f,function(b,c,f,h){var i=a.select("g."+g+'[data-stack="'+f+'"]');i.empty()||h.renderer(c).mouseLeave(i,b,c,d,e,h)},function(a){return d},!1),b.selectAll("*").remove()},b}(i);c.renderers=f},{"./model":3}],6:[function(a,b,c){var d=this&&this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);a.prototype=null===b?Object.create(b):(c.prototype=b.prototype,new c)},e=a("d3"),f=a("./utils"),g=a("./model"),h=a("./renderer"),i=a("./ui_dialogs"),j=function(){function a(a){this.desc=a,this.used=0}return a}(),k=function(){function a(a,b,c){void 0===c&&(c={}),this.data=a,this.options={layout:"vertical",elemWidth:100,elemHeight:40,width:100,height:500,additionalDesc:[],hideUsed:!0,addAtEndOnClick:!1},f.merge(this.options,c),this.$node=e.select(b).append("div").classed("lu-pool",!0),this.changeDataStorage(a)}return a.prototype.changeDataStorage=function(a){var b=this;if(this.data&&this.data.on(["addColumn.pool","removeColumn.pool","addRanking.pool","removeRanking.pool","addDesc.pool"],null),this.data=a,this.entries=a.getColumns().concat(this.options.additionalDesc).map(function(a){return new j(a)}),a.on(["addDesc.pool"],function(a){b.entries.push(new j(a)),b.update()}),this.options.hideUsed){var c=this;a.on(["addColumn.pool","removeColumn.pool"],function(a){var b=a.desc,d="addColumn"===this.type?1:-1;c.entries.some(function(a){return a.desc!==b?!1:(a.used+=d,!0)}),c.update()}),a.on(["addRanking.pool","removeRanking.pool"],function(a){var b=a.flatColumns.map(function(a){return a.desc}),d="addRanking"===this.type?1:-1;c.entries.some(function(a){return b.indexOf(a.desc)<0?!1:(a.used+=d,!0)}),c.update()}),a.getRankings().forEach(function(a){var b=a.flatColumns.map(function(a){return a.desc}),d=1;c.entries.some(function(a){return b.indexOf(a.desc)<0?!1:void(a.used+=d)})})}},a.prototype.remove=function(){this.$node.remove(),this.data&&this.data.on(["addColumn.pool","removeColumn.pool","addRanking.pool","removeRanking.pool","addDesc.pool"],null)},a.prototype.update=function(){var a=this,b=this.data,c=this.entries.filter(function(a){return 0===a.used}).map(function(a){return a.desc}),d=this.$node.selectAll("div.header").data(c),f=d.enter().append("div").attr({"class":"header",draggable:!0}).on("dragstart",function(a){var c=e.event;c.dataTransfer.effectAllowed="copyMove",c.dataTransfer.setData("text/plain",a.label),c.dataTransfer.setData("application/caleydo-lineup-column",JSON.stringify(b.toDescRef(a))),g.isNumberColumn(a)&&c.dataTransfer.setData("application/caleydo-lineup-column-number",JSON.stringify(b.toDescRef(a)))}).style({width:this.options.elemWidth+"px",height:this.options.elemHeight+"px"});switch(this.options.addAtEndOnClick&&f.on("click",function(b){
a.data.push(a.data.getLastRanking(),b)}),f.append("span").classed("label",!0).text(function(a){return a.label}),d.attr("class",function(a){return"header "+(a.cssClass||"")+" "+a.type}),d.style({transform:function(b,c){var d=a.layout(c);return"translate("+d.x+"px,"+d.y+"px)"},"background-color":function(a){var b=a;return b.cssClass?null:b.color||g.Column.DEFAULT_COLOR}}),d.attr({title:function(a){return a.label}}),d.select("span").text(function(a){return a.label}),d.exit().remove(),this.options.layout){case"horizontal":this.$node.style({width:this.options.elemWidth*c.length+"px",height:1*this.options.elemHeight+"px"});break;case"grid":var h=e.round(this.options.width/this.options.elemWidth,0);this.$node.style({width:h*this.options.elemWidth+"px",height:Math.ceil(c.length/h)*this.options.elemHeight+"px"});break;default:this.$node.style({width:1*this.options.elemWidth+"px",height:this.options.elemHeight*c.length+"px"})}},a.prototype.layout=function(a){switch(this.options.layout){case"horizontal":return{x:a*this.options.elemWidth,y:0};case"grid":var b=e.round(this.options.width/this.options.elemWidth,0);return{x:a%b*this.options.elemWidth,y:Math.floor(a/b)*this.options.elemHeight};default:return{x:0,y:a*this.options.elemHeight}}},a}();c.PoolRenderer=k;var l=function(){function a(a,b,c){var d=this;void 0===c&&(c={}),this.data=a,this.options={slopeWidth:150,columnPadding:5,headerHistogramHeight:40,headerHeight:20,manipulative:!0,histograms:!1,filterDialogs:i.filterDialogs(),searchAble:function(a){return a instanceof g.StringColumn},sortOnLabel:!0,autoRotateLabels:!1,rotationHeight:50,rotationDegree:-20,freezeCols:0},this.histCache=e.map(),this.dragHandler=e.behavior.drag().on("dragstart",function(){e.select(this).classed("dragging",!0),e.event.sourceEvent.stopPropagation(),e.event.sourceEvent.preventDefault()}).on("drag",function(a){var b=Math.max(e.mouse(this.parentNode)[0],2);a.setWidth(b),e.event.sourceEvent.stopPropagation(),e.event.sourceEvent.preventDefault()}).on("dragend",function(){e.select(this).classed("dragging",!1),e.event.sourceEvent.stopPropagation(),e.event.sourceEvent.preventDefault()}),this.dropHandler=f.dropAble(["application/caleydo-lineup-column-ref","application/caleydo-lineup-column"],function(a,b,c){var e=null;if("application/caleydo-lineup-column-ref"in a){var f=a["application/caleydo-lineup-column-ref"];e=d.data.find(f),c?e=d.data.clone(e):e.removeMe()}else{var h=JSON.parse(a["application/caleydo-lineup-column"]);e=d.data.create(d.data.fromDescRef(h))}if(b instanceof g.Column)return b.insertAfterMe(e);var i=d.data.getLastRanking();return null!==i.push(e)}),f.merge(this.options,c),this.$node=e.select(b).append("div").classed("lu-header",!0),this.$node.append("div").classed("drop",!0).call(this.dropHandler),this.changeDataStorage(a)}return a.prototype.changeDataStorage=function(a){var b=this;this.data&&this.data.on(["dirtyHeader.headerRenderer","orderChanged.headerRenderer","selectionChanged.headerRenderer"],null),this.data=a,a.on("dirtyHeader.headerRenderer",f.delayedCall(this.update.bind(this),1)),this.options.histograms&&(a.on("orderChanged.headerRenderer",function(){b.updateHist(),b.update()}),a.on("selectionChanged.headerRenderer",f.delayedCall(this.drawSelection.bind(this),1)))},Object.defineProperty(a.prototype,"sharedHistCache",{get:function(){return this.histCache},enumerable:!0,configurable:!0}),a.prototype.currentHeight=function(){return parseInt(this.$node.style("height"),10)},a.prototype.updateHist=function(){var a=this,b=this.data.getRankings();b.forEach(function(b){var c=b.getOrder(),d=b.flatColumns,e=null==c?null:a.data.stats(c);d.filter(function(a){return a instanceof g.NumberColumn}).forEach(function(b){a.histCache.set(b.id,null===e?null:e.stats(b))}),d.filter(g.isCategoricalColumn).forEach(function(b){a.histCache.set(b.id,null===e?null:e.hist(b))})})},a.prototype.drawSelection=function(){var a=this;if(this.options.histograms){var b=this.$node.node();[].slice.call(b.querySelectorAll("div.bar")).forEach(function(a){return a.classList.remove("selected")});var c=this.data.getSelection();c.length<=0||this.data.view(c).then(function(c){var d=a.data.getRankings();d.forEach(function(a){var d=a.flatColumns;d.filter(function(a){return a instanceof g.NumberColumn}).forEach(function(a){var d=[].slice.call(b.querySelectorAll('div.header[data-id="'+a.id+'"] div.bar'));c.forEach(function(b){for(var c=a.getValue(b),e=1;e<d.length;++e){var f=d[e];if(f.dataset.x>c){d[e-1].classList.add("selected");break}if(e===d.length-1){f.classList.add("selected");break}}})}),d.filter(g.isCategoricalColumn).forEach(function(a){var d=b.querySelector('div.header[data-id="'+a.id+'"]');c.forEach(function(b){var c=a.getCategories(b);(c||[]).forEach(function(a){d.querySelector('div.bar[data-cat="'+a+'"]').classList.add("selected")})})})})})}},a.prototype.update=function(){function a(b){return b instanceof g.StackColumn&&!b.collapsed&&!b.compressed?1+Math.max.apply(Math,b.children.map(a)):1}var b=this,c=this,d=this.data.getRankings(),f=[],h=0;d.forEach(function(a){h+=a.flatten(f,h,1,b.options.columnPadding)+b.options.slopeWidth}),h-=this.options.slopeWidth;var i=f.map(function(a){return a.col});this.options.histograms&&this.histCache.empty()&&d.length>0&&this.updateHist(),this.renderColumns(i,f);var j=Math.max.apply(Math,i.map(a)),k=(this.options.histograms?this.options.headerHistogramHeight:this.options.headerHeight)+(j-1)*this.options.headerHeight;if(this.options.autoRotateLabels){var l=!1;this.$node.selectAll("div.header").style("height",k+"px").select("div.lu-label").each(function(a){var b=this.querySelector("span.lu-label").offsetWidth,d=a.getWidth();b>d+30?(e.select(this).style("transform","rotate("+c.options.rotationDegree+"deg)"),l=!0):e.select(this).style("transform",null)}),this.$node.selectAll("div.header").style("margin-top",l?this.options.rotationHeight+"px":null),k+=l?this.options.rotationHeight:0}this.$node.style("height",k+"px")},a.prototype.createToolbar=function(a){var b=this,c=this.options.filterDialogs,d=this.data,f=a.filter(function(a){return!(a instanceof g.RankColumn)}),h=a.filter(function(a){return a instanceof g.StackColumn});h.append("i").attr("class","fa fa-tasks").attr("title","Edit Weights").on("click",function(a){i.openEditWeightsDialog(a,e.select(this.parentNode.parentNode)),e.event.stopPropagation()}),f.append("i").attr("class","fa fa-pencil-square-o").attr("title","Rename").on("click",function(a){i.openRenameDialog(a,e.select(this.parentNode.parentNode)),e.event.stopPropagation()}),f.append("i").attr("class","fa fa-code-fork").attr("title","Generate Snapshot").on("click",function(a){var b=d.pushRanking();b.push(d.clone(a)),e.event.stopPropagation()}),a.filter(function(a){return a instanceof g.LinkColumn}).append("i").attr("class","fa fa-external-link").attr("title","Edit Link Pattern").on("click",function(a){i.openEditLinkDialog(a,e.select(this.parentNode.parentNode)),e.event.stopPropagation()}),a.filter(function(a){return c.hasOwnProperty(a.desc.type)}).append("i").attr("class","fa fa-filter").attr("title","Filter").on("click",function(a){c[a.desc.type](a,e.select(this.parentNode.parentNode),d),e.event.stopPropagation()}),a.filter(function(a){return b.options.searchAble(a)}).append("i").attr("class","fa fa-search").attr("title","Search").on("click",function(a){i.openSearchDialog(a,e.select(this.parentNode.parentNode),d),e.event.stopPropagation()}),f.append("i").attr("class","fa").classed("fa-toggle-left",function(a){return!a.compressed}).classed("fa-toggle-right",function(a){return a.compressed}).attr("title","(Un)Collapse").on("click",function(a){a.compressed=!a.compressed,e.select(this).classed("fa-toggle-left",!a.compressed).classed("fa-toggle-right",a.compressed),e.event.stopPropagation()}),h.append("i").attr("class","fa").classed("fa-compress",function(a){return!a.collapsed}).classed("fa-expand",function(a){return a.collapsed}).attr("title","Compress/Expand").on("click",function(a){a.collapsed=!a.collapsed,e.select(this).classed("fa-compress",!a.collapsed).classed("fa-expand",a.collapsed),e.event.stopPropagation()}),a.append("i").attr("class","fa fa-times").attr("title","Hide").on("click",function(a){a instanceof g.RankColumn?(d.removeRanking(a),0===d.getRankings().length&&d.pushRanking()):a.removeMe(),e.event.stopPropagation()})},a.prototype.updateFreeze=function(a){var b=this.options.freezeCols;this.$node.selectAll("div.header").style("z-index",function(a,c){return b>c?1:null}).style("transform",function(c,d){return b>d?"translate("+a+"px,0)":null})},a.prototype.renderColumns=function(a,b,c,d){var h=this;void 0===c&&(c=this.$node),void 0===d&&(d="header");var i=c.selectAll("div."+d).data(a,function(a){return a.id}),j=i.enter().append("div").attr({"class":d}),k=j.append("div").classed("lu-label",!0).on("click",function(a){h.options.manipulative&&!e.event.defaultPrevented&&a.toggleMySorting()}).on("dragstart",function(a){var b=e.event;b.dataTransfer.effectAllowed="copyMove",b.dataTransfer.setData("text/plain",a.label),b.dataTransfer.setData("application/caleydo-lineup-column-ref",a.id);var c=JSON.stringify(h.data.toDescRef(a.desc));b.dataTransfer.setData("application/caleydo-lineup-column",c),g.isNumberColumn(a)&&(b.dataTransfer.setData("application/caleydo-lineup-column-number",c),b.dataTransfer.setData("application/caleydo-lineup-column-number-ref",a.id))});k.append("i").attr("class","fa fa sort_indicator"),k.append("span").classed("lu-label",!0).attr({draggable:this.options.manipulative}),this.options.manipulative&&(j.append("div").classed("handle",!0).call(this.dragHandler).style("width",this.options.columnPadding+"px").call(this.dropHandler),j.append("div").classed("toolbar",!0).call(this.createToolbar.bind(this))),this.options.histograms&&j.append("div").classed("histogram",!0),i.style({width:function(a,c){return b[c].width+h.options.columnPadding+"px"},left:function(a,c){return b[c].offset+"px"},"background-color":function(a){return a.color}}),i.attr({"class":function(a){return d+" "+(a.cssClass||"")+" "+(a.compressed?"compressed":"")+" "+a.headerCssClass+" "+(h.options.autoRotateLabels?"rotateable":"")+" "+(a.isFiltered()?"filtered":"")},title:function(a){return a.label},"data-id":function(a){return a.id}}),i.select("i.sort_indicator").attr("class",function(a){var b=a.findMyRanker();return b&&b.sortCriteria().col===a?"sort_indicator fa fa-sort-"+(b.sortCriteria().asc?"asc":"desc"):"sort_indicator fa"}),i.select("span.lu-label").text(function(a){return a.label});var l=this;i.filter(function(a){return a instanceof g.StackColumn}).each(function(a){if(a.collapsed||a.compressed)e.select(this).selectAll("div."+d+"_i").remove();else{var b=[];a.flatten(b,0,1,l.options.columnPadding);var c=b.map(function(a){return a.col});l.renderColumns(c,b,e.select(this),d+("_i"!==d.substr(d.length-2)?"_i":""))}}).call(f.dropAble(["application/caleydo-lineup-column-number-ref","application/caleydo-lineup-column-number"],function(a,b,c){var d=null;if("application/caleydo-lineup-column-number-ref"in a){var e=a["application/caleydo-lineup-column-number-ref"];d=h.data.find(e),c?d=h.data.clone(d):d.removeMe()}else{var f=JSON.parse(a["application/caleydo-lineup-column-number"]);d=h.data.create(h.data.fromDescRef(f))}return b.push(d)})),this.options.histograms&&(i.filter(function(a){return g.isCategoricalColumn(a)}).each(function(a){var b=e.select(this).select("div.histogram"),c=l.histCache.get(a.id);c&&c.then(function(c){var d=b.selectAll("div.bar").data(c.hist);d.enter().append("div").classed("bar",!0);var f=e.scale.ordinal().domain(a.categories).rangeBands([0,100],.1),g=e.scale.linear().domain([0,c.maxBin]).range([0,100]);d.style({left:function(a){return f(a.cat)+"%"},width:function(a){return f.rangeBand()+"%"},top:function(a){return 100-g(a.y)+"%"},height:function(a){return g(a.y)+"%"},"background-color":function(b){return a.colorOf(b.cat)}}).attr({title:function(a){return a.cat+": "+a.y},"data-cat":function(a){return a.cat}}),d.exit().remove()})}),i.filter(function(a){return a instanceof g.NumberColumn}).each(function(a){var b=e.select(this).select("div.histogram"),c=l.histCache.get(a.id);c&&c.then(function(a){var c=b.selectAll("div.bar").data(a.hist);c.enter().append("div").classed("bar",!0);var d=e.scale.ordinal().domain(e.range(a.hist.length).map(String)).rangeBands([0,100],.1),f=e.scale.linear().domain([0,a.maxBin]).range([0,100]);c.style({left:function(a,b){return d(String(b))+"%"},width:function(a,b){return d.rangeBand()+"%"},top:function(a){return 100-f(a.y)+"%"},height:function(a){return f(a.y)+"%"}}).attr({title:function(a,b){return"Bin "+b+": "+a.y},"data-x":function(a){return a.x}}),c.exit().remove();var g=b.select("div.mean");g.empty()&&(g=b.append("div").classed("mean",!0)),g.style("left",100*a.mean+"%")})})),i.exit().remove()},a}();c.HeaderRenderer=l;var m=function(a){function b(b,c,d,g){void 0===g&&(g={}),a.call(this),this.data=b,this.slicer=d,this.options={rowHeight:20,rowPadding:1,rowBarPadding:1,idPrefix:"",slopeWidth:150,columnPadding:5,stacked:!0,animation:!1,animationDuration:1e3,renderers:h.renderers(),meanLine:!1,actions:[],freezeCols:0},this.currentFreezeLeft=0,this.histCache=e.map(),f.merge(this.options,g),this.$node=e.select(c).append("svg").classed("lu-body",!0),this.changeDataStorage(b)}return d(b,a),b.prototype.createEventList=function(){return a.prototype.createEventList.call(this).concat(["hoverChanged"])},Object.defineProperty(b.prototype,"node",{get:function(){return this.$node.node()},enumerable:!0,configurable:!0}),b.prototype.setOption=function(a,b){this.options[a]=b},b.prototype.changeDataStorage=function(a){this.data&&this.data.on(["dirtyValues.bodyRenderer","selectionChanged.bodyRenderer"],null),this.data=a,a.on("dirtyValues.bodyRenderer",f.delayedCall(this.update.bind(this),1)),a.on("selectionChanged.bodyRenderer",f.delayedCall(this.drawSelection.bind(this),1))},b.prototype.createContext=function(a){var b=this.options;return{rowKey:this.data.rowKey,cellY:function(c){return(c+a)*b.rowHeight},cellPrevY:function(c){return(c+a)*b.rowHeight},cellX:function(a){return 0},rowHeight:function(a){return b.rowHeight*(1-b.rowPadding)},renderer:function(a){if(a.compressed&&g.isNumberColumn(a))return b.renderers.heatmap;if(a instanceof g.StackColumn&&a.collapsed)return b.renderers.number;var c=b.renderers[a.desc.type];return c||h.defaultRenderer()},render:function(a,b,c,d){void 0===d&&(d=this);var e=b.node(),f=e.__renderer__,g=this.renderer(a);f!==g&&(b.selectAll("*").remove(),e.__renderer__=g),g.render(b,a,c,d)},showStacked:function(a){return b.stacked},idPrefix:b.idPrefix,animated:function(a){return b.animation?a.transition().duration(b.animationDuration):a},showMeanLine:function(a){return b.meanLine&&g.isNumberColumn(a)&&!a.compressed&&a.parent instanceof g.RankColumn},option:function(a,c){return a in b?b[a]:c}}},b.prototype.updateClipPathsImpl=function(a,b,c){var d=this.$node.select("defs.body");d.empty()&&(d=this.$node.append("defs").classed("body",!0));var e=d.selectAll(function(){return this.getElementsByTagName("clipPath")}).data(a,function(a){return a.id});e.enter().append("clipPath").attr("id",function(a){return b.idPrefix+"clipCol"+a.id}).append("rect").attr({y:0}),e.exit().remove(),e.select("rect").attr({x:0,width:function(a){return Math.max(a.getWidth()-5,0)},height:c})},b.prototype.updateClipPaths=function(a,b,c){var d=this,e=[],f=0;a.forEach(function(a){var b=a.flatten(e,f,2,d.options.columnPadding);f+=b+d.options.slopeWidth}),this.updateClipPathsImpl(e.map(function(a){return a.col}),b,c);var g=this.$node.select("clipPath#c"+b.idPrefix+"Freeze");g.empty()&&(g=this.$node.append("clipPath").attr("id","c"+b.idPrefix+"Freeze").append("rect").attr({y:0,width:2e4,height:c})),g.select("rect").attr({height:c})},b.prototype.renderRankings=function(a,b,c,d,f,g){function h(a,b,c,g,h){a.classed("hover",!0);var i=a.select("g.values").selectAll("g.uchild").data([g].concat(g.children),function(a){return a.id});i.enter().append("g").attr({"class":"uchild"}).append("g").classed("child",!0),i.select("g.child").attr({transform:function(a,b){return"translate("+d[h].shifts[b]+",0)"}}).each(function(a,d){var g=this;l[h].then(function(h){f.renderer(a).mouseEnter(b.selectAll('g.child[data-index="'+d+'"]'),e.select(g),a,h[c],c,f)})}),i.exit().remove()}function i(a,b,c,d,g){a.classed("hover",!1),a.select("g.values").selectAll("g.uchild").each(function(a,d){var h=this;l[g].then(function(g){f.renderer(a).mouseLeave(b.selectAll('g.child[data-index="'+d+'"]'),e.select(h).select("g.child"),a,g[c],c,f)})}).remove()}var j=this,k=this,l=c.map(function(a){return j.data.view(a)}),m=a.selectAll("g.ranking").data(b,function(a){return a.id}),n=m.enter().append("g").attr({"class":"ranking",transform:function(a,b){return"translate("+d[b].shift+",0)"}});n.append("g").attr("class","rows"),n.append("g").attr("class","cols"),f.animated(m).attr({transform:function(a,b){return"translate("+d[b].shift+",0)"}});var o=m.select("g.cols").selectAll("g.uchild").data(function(a){return[a].concat(a.children)},function(a){return a.id});o.enter().append("g").attr("class","uchild").append("g").attr({"class":"child",transform:function(a,b,c){return"translate("+d[c].shifts[b]+",0)"}}),o.exit().remove(),o=o.select("g.child"),o.attr({"data-index":function(a,b){return b}}),f.animated(o).attr({transform:function(a,b,c){return"translate("+d[c].shifts[b]+",0)"}}).each(function(a,b,c){var d=e.select(this);if(l[c].then(function(b){f.render(a,d,b,f)}),f.showMeanLine(a)){var h=k.histCache.get(a.id);h&&h.then(function(b){var c=d.selectAll("line.meanline").data([b.mean]);c.enter().append("line").attr("class","meanline"),c.exit().remove(),c.attr("x1",a.getWidth()*b.mean).attr("x2",a.getWidth()*b.mean).attr("y2",g)})}else d.selectAll("line.meanline").remove()}),this.mouseOverItem=function(a,b){void 0===b&&(b=!0),m.each(function(c,d){var f=e.select(this),g=f.selectAll('g.row[data-index="'+a+'"]'),j=f.select("g.cols");if(!g.empty()){var k=g.datum().i;b?h(g,j,k,c,d):i(g,j,k,c,d)}}),k.updateFrozenRows()};var p=m.select("g.rows").selectAll("g.row").data(function(a,b){return c[b].map(function(a,b){return{d:a,i:b}})}),q=p.enter().append("g").attr({"class":"row"});q.append("rect").attr({"class":"bg"}),q.append("g").attr({"class":"values"}),q.on("mouseenter",function(a){j.mouseOver(a.d,!0)}).on("mouseleave",function(a){j.mouseOver(a.d,!1)}).on("click",function(a){j.select(a.d,e.event.ctrlKey)}),p.attr({"data-index":function(a){return a.d}}).classed("selected",function(a){return j.data.isSelected(a.d)}),p.select("rect").attr({y:function(a){return f.cellY(a.i)},height:function(a){return f.rowHeight(a.i)},width:function(a,b,c){return d[c].width},"class":function(a,b){return"bg "+(b%2===0?"even":"odd")}}),p.exit().remove(),m.exit().remove()},b.prototype.select=function(a,b){void 0===b&&(b=!1);var c=this.data.toggleSelection(a,b);this.$node.selectAll('g.row[data-index="'+a+'"], line.slope[data-index="'+a+'"]').classed("selected",c)},b.prototype.drawSelection=function(){var a=this.data.getSelection();if(0===a.length)this.$node.selectAll("g.row.selected, line.slope.selected").classed("selected",!1);else{var b=e.set(a);this.$node.selectAll("g.row").classed("selected",function(a){return b.has(String(a.d))}),this.$node.selectAll("line.slope").classed("selected",function(a){return b.has(String(a.data_index))})}},b.prototype.mouseOver=function(a,b){void 0===b&&(b=!0),this.fire("hoverChanged",b?a:-1),this.mouseOverItem(a,b),this.$node.selectAll('line.slope[data-index="'+a+'"]').classed("hover",b)},b.prototype.renderSlopeGraphs=function(a,b,c,d,e){var f=this,g=c.slice(1).map(function(a,b){return{left:c[b],left_i:b,right:a,right_i:b+1}}),h=a.selectAll("g.slopegraph").data(g);h.enter().append("g").attr({"class":"slopegraph"}),h.attr({transform:function(a,b){return"translate("+(d[b+1].shift-f.options.slopeWidth)+",0)"}});var i=h.selectAll("line.slope").data(function(a,b){var c={};return a.right.forEach(function(a,b){c[a]=b}),a.left.map(function(a,b){return{data_index:a,lpos:b,rpos:c[a]}}).filter(function(a){return null!=a.rpos})});i.enter().append("line").attr({"class":"slope",x2:this.options.slopeWidth}).on("mouseenter",function(a){f.mouseOver(a.data_index,!0)}).on("mouseleave",function(a){f.mouseOver(a.data_index,!1)}),i.attr({"data-index":function(a){return a.data_index}}),i.attr({y1:function(a){return.5*e.rowHeight(a.lpos)+e.cellY(a.lpos)},y2:function(a){return.5*e.rowHeight(a.rpos)+e.cellY(a.rpos)}}),i.exit().remove(),h.exit().remove()},b.prototype.updateFreeze=function(a){var b=this,c=this.options.freezeCols,d=this.$node.select("g.cols"),f=this.$node.select("#c"+this.options.idPrefix+"Freeze").select("rect"),g=d.select('g.child[data-index="'+c+'"]');g.empty()&&(g=d.select("g.child:last-of-type"));var h=e.transform(g.attr("transform")||"").translate[0];f.attr("x",a+h),d.selectAll("g.uchild").attr({"clip-path":function(a,d){return c>d?null:"url(#c"+b.options.idPrefix+"Freeze)"},transform:function(b,d){return c>d?"translate("+a+",0)":null}}),this.currentFreezeLeft=a,this.updateFrozenRows()},b.prototype.updateFrozenRows=function(){var a=this,b=this.options.freezeCols;if(!(0>=b)){var c=this.currentFreezeLeft,d=this.$node.select("g.rows");d.select("g.row.hover g.values").selectAll("g.uchild").attr({"clip-path":function(c,d){return b>d?null:"url(#c"+a.options.idPrefix+"Freeze)"},transform:function(a,d){return b>d?"translate("+c+",0)":null}})}},b.prototype.update=function(){var a=this,b=this.data.getRankings(),c=e.max(b,function(a){return a.getOrder().length})||0,d=this.options.rowHeight*c,f=this.slicer(0,c,function(b){return b*a.options.rowHeight}),h=function(a){return 0===f.from&&a.length<=f.to?a:a.slice(f.from,Math.min(a.length,f.to))},i=b.map(function(a){return h(a.getOrder())}),j=this.createContext(f.from),k=0,l=b.map(function(b,c){var d=k;k+=a.options.slopeWidth;var e=0,f=[b].concat(b.children).map(function(b){var c=e;return e+=(b.compressed?g.Column.COMPRESSED_WIDTH:b.getWidth())+a.options.columnPadding,b instanceof g.StackColumn&&!b.collapsed&&!b.compressed&&(e+=a.options.columnPadding*(b.length-1)),c});return k+=e,{shift:d,shifts:f,width:e}});this.$node.attr({width:k,height:d}),this.updateClipPaths(b,j,d);var m=this.$node.select("g.body");m.empty()&&(m=this.$node.append("g").classed("body",!0)),this.renderRankings(m,b,i,l,j,d),this.renderSlopeGraphs(m,b,i,l,j)},b}(f.AEventDispatcher);c.BodyRenderer=m},{"./model":3,"./renderer":5,"./ui_dialogs":7,"./utils":8,d3:void 0}],7:[function(a,b,c){function d(a,b,c){return void 0===c&&(c=!1),'<span style="font-weight: bold">'+a+'</span><form onsubmit="return false">'+b+'<button type = "submit" class="ok fa fa-check" title="ok"></button><button type = "reset" class="cancel fa fa-times" title="cancel"></button><button type = "button" class="reset fa fa-undo" title="reset"></button></form>'}function e(a,b,c){var e=p.offset(a.node()),f=d3.select("body").append("div").attr({"class":"lu-popup2"}).style({left:e.left+"px",top:e.top+"px"}).html(d(b,c));f.on("keydown",function(){27===d3.event.which&&f.remove()});var g=f.select("input[autofocus]").node();return g&&g.focus(),f}function f(a,b){var c=e(b,"Rename Column",'<input type="text" size="15" value="'+a.label+'" required="required" autofocus="autofocus"><br><input type="color" size="15" value="'+a.color+'" required="required"><br>');c.select(".ok").on("click",function(){var b=c.select('input[type="text"]').property("value"),d=c.select('input[type="color"]').property("value");a.setMetaData(b,d),c.remove()}),c.select(".cancel").on("click",function(){c.remove()})}function g(a,b){var c='<input type="text" size="15" value="'+a.getLink()+'" required="required" autofocus="autofocus"><br>',d=e(b,"Edit Link ($ as Placeholder)",c);d.select(".ok").on("click",function(){var b=d.select('input[type="text"]').property("value");a.setLink(b),d.remove()}),d.select(".cancel").on("click",function(){d.remove()})}function h(a,b,c){function d(){var b=f.select('input[type="text"]').property("value"),d=f.select('input[type="text"]').property("checked");b.length>0&&(d&&(b=new RegExp(b)),c.searchSelect(b,a)),f.remove()}var f=e(b,"Search",'<input type="text" size="15" value="" required="required" autofocus="autofocus"><br><label><input type="checkbox">RegExp</label><br>');f.select('input[type="text"]').on("input",function(){var b=d3.event.target.value;if(b.length>=3){var d=f.select('input[type="checkbox"]').property("checked");d&&(b=new RegExp(b)),c.searchSelect(b,a)}}),f.select('input[type="checkbox"]').on("change",d),f.select(".ok").on("click",d),f.select(".cancel").on("click",function(){f.remove()})}function i(a,b){function c(){i.select(".bar").transition().style({width:function(a){return g(a.weight)+"px"}})}var d=a.weights,f=a.children.map(function(a,b){return{col:a,weight:100*d[b]}}),g=d3.scale.linear().domain([0,100]).range([0,120]),h=e(b,"Edit Weights","<table></table>"),i=h.select("table").selectAll("tr").data(f),j=i.enter().append("tr");j.append("td").append("input").attr({type:"number",value:function(a){return a.weight},size:5}).on("input",function(a){a.weight=+this.value,c()}),j.append("td").append("div").attr("class",function(a){return"bar "+a.col.cssClass}).style("background-color",function(a){return a.col.color}),j.append("td").text(function(a){return a.col.label}),c(),h.select(".cancel").on("click",function(){a.setWeights(d),h.remove()}),h.select(".ok").on("click",function(){a.setWeights(f.map(function(a){return a.weight})),h.remove()})}function j(a,b){void 0===b&&(b=!1),a.classed("filtered",b)}function k(a,b){function c(){var a=g.select("tbody").selectAll("tr").data(h);a.select(".checkmark").html(function(a){return'<i class="fa fa-'+(a.isChecked?"check-":"")+'square-o"></i>'}).on("click",function(a){a.isChecked=!a.isChecked,c()}),a.select(".datalabel").style("opacity",function(a){return a.isChecked?"1.0":".8"})}function d(c){j(b,c&&c.length>0&&c.length<a.categories.length),a.setFilter(c)}var f=a.getFilter()||[],g=e(b,"Edit Filter",'<div class="selectionTable"><table><thead><th></th><th>Category</th></thead><tbody></tbody></table></div>'),h=a.categories.map(function(a){return{d:a,isChecked:0===f.length||f.indexOf(a)>=0}}),i=g.select("tbody").selectAll("tr").data(h);i.enter().append("tr"),i.append("td").attr("class","checkmark"),i.append("td").attr("class","datalabel").text(function(a){return a.d}),c(),g.select(".cancel").on("click",function(){d(f),g.remove()}),g.select(".reset").on("click",function(){h.forEach(function(a){return a.isChecked=!0}),c(),d(null)}),g.select(".ok").on("click",function(){var b=h.filter(function(a){return a.isChecked}).map(function(a){return a.d});b.length===a.categories.length&&(b=[]),d(b),g.remove()})}function l(a,b){function c(c){j(b,c&&""!==c),a.setFilter(c)}function d(a){var b=g.select('input[type="text"]').property("value");if(b.length>=3||a){var d=g.select('input[type="checkbox"]').property("checked");d&&(b=new RegExp(b)),c(b)}}var f=a.getFilter()||"",g=e(b,"Filter",'<input type="text" placeholder="containing..." autofocus="true" size="15" value="'+(f instanceof RegExp?f.source:f)+'" autofocus="autofocus">\n    <br><label><input type="checkbox" '+(f instanceof RegExp?'checked="checked"':"")+">RegExp</label>\n    <br>");g.select('input[type="checkbox"]').on("change",d),g.select('input[type="text"]').on("input",d),g.select(".cancel").on("click",function(){g.select('input[type="text"]').property("value",f),g.select('input[type="checkbox"]').property("checked",f instanceof RegExp?"checked":null),c(f),g.remove()}),g.select(".reset").on("click",function(){g.select('input[type="text"]').property("value",""),g.select('input[type="checkbox"]').property("checked",null),c(null)}),g.select(".ok").on("click",function(){d(!0),g.remove()})}function m(a,b,c){function e(c){i=c,j(b,!c.eq(h)),a.setMapping(c);var d=l.property("checked");d?a.setFilter(c.domain[0],c.domain[1]):a.setFilter()}var f=p.offset(b.node()),g=a.getMapping(),h=a.getOriginalMapping(),i=g.clone(),k=d3.select("body").append("div").attr({"class":"lu-popup"}).style({left:f.left+"px",top:f.top+"px"}).html(d("Change Mapping",'<div class="mappingArea"></div><label><input type="checkbox" id="filterIt" value="filterIt">Filter Outliers</label><br>')),l=k.select("input").on("change",function(){e(i)});l.property("checked",a.isFiltered());var m={callback:e,triggerCallback:"dragend"},n=c.mappingSample(a),o=q.create(k.select(".mappingArea").node(),i,h,n,m);k.select(".ok").on("click",function(){e(o.scale),k.remove()}),k.select(".cancel").on("click",function(){a.setMapping(g),j(b,!g.eq(h)),k.remove()}),k.select(".reset").on("click",function(){g=h,i=g.clone(),e(i),k.selectAll(".mappingArea *").remove(),o=q.create(k.select(".mappingArea").node(),i,h,n,m)})}function n(a,b){function c(){j.select(".bar").transition().style({width:function(a){return h(a.range)+"px"}})}var d=a.getScale().range,f=a.categoryColors,g=a.categories.map(function(a,b){return{cat:a,range:100*d[b],color:f[b]}}),h=d3.scale.linear().domain([0,100]).range([0,120]),i=e(b,"Edit Categorical Mapping","<table></table>"),j=i.select("table").selectAll("tr").data(g),k=j.enter().append("tr");k.append("td").append("input").attr({type:"number",value:function(a){return a.range},min:0,max:100,size:5}).on("input",function(a){a.range=+this.value,c()}),k.append("td").append("div").attr("class","bar").style("background-color",function(a){return a.color}),k.append("td").text(function(a){return a.cat}),c(),i.select(".cancel").on("click",function(){a.setRange(d),i.remove()}),i.select(".ok").on("click",function(){a.setRange(g.map(function(a){return a.range/100})),i.remove()})}function o(){return{string:l,categorical:k,number:m,ordinal:n}}var p=a("./utils"),q=a("./mappingeditor");c.dialogForm=d,c.makePopup=e,c.openRenameDialog=f,c.openEditLinkDialog=g,c.openSearchDialog=h,c.openEditWeightsDialog=i,c.filterDialogs=o},{"./mappingeditor":2,"./utils":8}],8:[function(a,b,c){function d(a,b,c){void 0===b&&(b=100),void 0===c&&(c=this);var d=-1;return function(){for(var e=[],f=0;f<arguments.length;f++)e[f-0]=arguments[f];d>=0&&(clearTimeout(d),d=-1),e.unshift(c),d=setTimeout(a.bind.apply(a,e),b)}}function e(a,b){return function(){for(var c=[],d=0;d<arguments.length;d++)c[d-0]=arguments[d];c.unshift(b||this.type),a.fire.apply(a,c)}}function f(){for(var a=[],b=0;b<arguments.length;b++)a[b-0]=arguments[b];for(var c=null,d=0;d<a.length;d++){var e=a[d],g=Object.keys(e);if(null!==c)for(var h=0;h<g.length;h++){var i=g[h],j=e[i];Object.prototype.toString.call(j)===o?(void 0===c[i]&&(c[i]={}),c[i]=f(c[i],j)):Object.prototype.toString.call(j)===p?(void 0===c[i]&&(c[i]=[]),c[i]=j.concat(c[i])):c[i]=j}else c=e}return c}function g(a){var b=a.getBoundingClientRect();return{left:b.left+window.pageXOffset,top:b.top+window.pageYOffset,width:b.width,height:b.height}}function h(a,b){var c=a.dataTransfer.types;return"function"==typeof c.indexOf?b.some(function(a){return c.indexOf(a)>=0}):"function"==typeof c.includes?b.some(function(a){return c.includes(a)}):"function"==typeof c.contains?b.some(function(a){return c.contains(a)}):!1}function i(a){var b=a.dataTransfer;return a.ctrlKey&&null!=b.effectAllowed.match(/copy/gi)||null==b.effectAllowed.match(/move/gi)}function j(a){var b=a.dataTransfer;i(a)?b.dropEffect="copy":b.dropEffect="move"}function k(a,b){return function(c){c.on("dragenter",function(){var b=m.event;return h(b,a)?(m.select(this).classed("drag_over",!0),!1):void m.select(this).classed("drag_over",!1)}).on("dragover",function(){var b=m.event;return h(b,a)?(b.preventDefault(),j(b),m.select(this).classed("drag_over",!0),!1):void 0}).on("dragleave",function(){m.select(this).classed("drag_over",!1)}).on("drop",function(c){var d=m.event;if(d.preventDefault(),m.select(this).classed("drag_over",!1),h(d,a)){var e={};return a.forEach(function(a){var b=d.dataTransfer.getData(a);""!==b&&(e[a]=b)}),b(e,c,i(d))}})}}var l=this&&this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);a.prototype=null===b?Object.create(b):(c.prototype=b.prototype,
new c)},m=a("d3");c.delayedCall=d,c.forwardEvent=e;var n=function(){function a(){this.forwarder=e(this),this.listeners=m.dispatch.apply(m,this.createEventList())}return a.prototype.on=function(a,b){var c=this;return arguments.length>1?(Array.isArray(a)?a.forEach(function(a){return c.listeners.on(a,b)}):this.listeners.on(a,b),this):this.listeners.on(a)},a.prototype.createEventList=function(){return[]},a.prototype.fire=function(a){for(var b=this,c=[],d=1;d<arguments.length;d++)c[d-1]=arguments[d];var e=function(a){var d={source:b,type:a,args:c};b.listeners[a].apply(d,c)};Array.isArray(a)?a.forEach(e.bind(this)):e(a)},a.prototype.forward=function(a){for(var b=[],c=1;c<arguments.length;c++)b[c-1]=arguments[c];a.on(b,this.forwarder)},a.prototype.unforward=function(a){for(var b=[],c=1;c<arguments.length;c++)b[c-1]=arguments[c];a.on(b,null)},a}();c.AEventDispatcher=n;var o="[object Object]",p="[object Array]";c.merge=f,c.offset=g;var q=function(a){function b(b,c,d){var e=this;void 0===d&&(d={}),a.call(this),this.container=b,this.content=c,this.options={topShift:function(){return 0},backupRows:5,rowHeight:10},this.prevScrollTop=0,this.shift=0,f(this.options,d),m.select(b).on("scroll.scroller",function(){return e.onScroll()}),this.prevScrollTop=b.scrollTop,this.shift=g(c).top-g(b).top}return l(b,a),b.prototype.createEventList=function(){return a.prototype.createEventList.call(this).concat(["scroll","redraw"])},b.prototype.select=function(a,b,c){var d,e=this.container.scrollTop-this.shift-this.options.topShift(),f=e+this.container.clientHeight,g=0;if(e>0){for(g=Math.round(e/this.options.rowHeight);g>=a&&c(g+1)>e;)g--;g-=this.options.backupRows}for(d=Math.round(f/this.options.rowHeight);b>=d&&c(d-1)<f;)d++;return d+=this.options.backupRows,{from:Math.max(g,a),to:Math.min(d,b)}},b.prototype.onScroll=function(){var a=this.container.scrollTop,b=this.container.scrollLeft;this.fire("scroll",a,b),Math.abs(this.prevScrollTop-a)>=this.options.rowHeight*this.options.backupRows&&(this.prevScrollTop=a,this.fire("redraw"))},b.prototype.destroy=function(){m.select(this.container).on("scroll.scroller",null)},b}(n);c.ContentScroller=q,c.hasDnDType=h,c.copyDnD=i,c.updateDropEffect=j,c.dropAble=k},{d3:void 0}]},{},[1]);